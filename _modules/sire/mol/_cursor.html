<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2022.12.07 -->
        <title>sire.mol._cursor - openbiosim - sire</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom_fonts.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom_style.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom_pygments.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --font-stack: Changa, sans-serif;
  --font-stack--monospace: Roboto Mono, monospace;
  --color-foreground-primary: #dddddd;
  --color-foreground-secondary: #cccccc;
  --color-foreground-muted: #d0d0d0;
  --color-foreground-border: #923eb1;
  --color-background-primary: #160f30;
  --color-background-secondary: #201146;
  --color-background-hover: #4f4fb0;
  --color-background-hover--transparent: #4f4fb000;
  --color-background-border: #403333;
  --color-background-item: #411a30;
  --color-announcement-background: #000000dd;
  --color-announcement-text: #eeebee;
  --color-admonition-title-background--note: #FFFFFF33;
  --color-admonition-title-background--warning: #FF000033;
  --color-admonition-background: #FFFFFF11;
  --color-brand-primary: #eeeeee;
  --color-brand-content: #00dfef;
  --color-highlight-on-target: #333300;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">openbiosim - sire</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../_static/logo.svg" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div>
<div class="sidebar-search">
  <div class="version_container">
    <div class="version_label">Branch</div>
    <div id="version_box" class="version_box"></div>
  </div>
</div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart/index.html">Quick Start Guide</a></li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../tutorial/index.html">Tutorial</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../tutorial/index_part01.html">Part 1 - Loading and Saving</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part01/01_importing_sire.html">Importing sire</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part01/02_loading_a_molecule.html">Loading a molecule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part01/03_simple_indexing.html">Simple indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part01/04_saving_a_molecule.html">Saving a molecule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part01/05_loading_from_multiple_files.html">Loading from multiple files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part01/06_supported_file_formats.html">Supported file formats</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../tutorial/index_part02.html">Part 2 - Indexing and Searching</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part02/01_indexing_atoms.html">Indexing Atoms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part02/02_indexing_residues.html">Indexing Residues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part02/03_indexing_chains.html">Indexing Chains</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part02/04_indexing_segments.html">Indexing Segments</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part02/05_indexing_molecules.html">Indexing Molecules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part02/06_indexing_bonds.html">Indexing Bonds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part02/07_indexing_angles.html">Indexing Angles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part02/08_indexing_dihedrals.html">Indexing Dihedrals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part02/09_indexing_impropers.html">Indexing Impropers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part02/10_searching.html">Searching</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../tutorial/index_part03.html">Part 3 - Molecular Properties</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part03/01_atom_properties.html">Atom Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part03/02_cursors.html">Cursors and Editing Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part03/03_residue_properties.html">Residue, Chain and Segment Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part03/04_molecule_properties.html">Molecule Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part03/05_bond_properties.html">Bond Views and Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part03/06_angle_properties.html">Angle Views and Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part03/07_dihedral_properties.html">Dihedral Views and Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part03/08_improper_properties.html">Improper Views and Properties</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../tutorial/index_part04.html">Part 4 - Measurement, Trajectories and Movement</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part04/01_measure.html">Measuring Distances and Angles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part04/02_trajectory.html">Measuring Trajectories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part04/03_energies.html">Measuring Energies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part04/04_energy_trajectories.html">Measuring Energies Across Trajectories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part04/05_movement.html">Moving Atoms and Molecules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorial/part04/06_move_internals.html">Moving Bonds, Angles and Dihedrals</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../cheatsheet/index.html">Detailed Guides</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cheatsheet/search.html">Searching</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api/index.html">Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/sire.html">sire module</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/sire_modules.html">Sub-modules</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/index_base.html">sire.base</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/base.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/index_cas.html">sire.cas</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/cas.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/index_io.html">sire.io</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/io.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/index_maths.html">sire.maths</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/maths.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/index_mm.html">sire.mm</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/mm.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/index_mol.html">sire.mol</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/mol.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/index_search.html">sire.search</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/search.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/index_stream.html">sire.stream</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/stream.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/index_system.html">sire.system</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/system.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/index_units.html">sire.units</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/units.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/index_utils.html">sire.utils</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/utils.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/index_vol.html">sire.vol</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/vol.html">Public API</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../support.html">How to ask for help</a></li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../contributing/index.html">Contributing</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing/development.html">Developerâ€™s guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing/codestyle.html">Coding Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing/packaging.html">Packaging releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing/roadmap.html">Roadmap</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributors.html">Contributors</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../code_of_conduct.html">Code of Conduct</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../acknowledgements.html">Acknowledgements</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for sire.mol._cursor</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span> <span class="k">as</span> <span class="n">_List</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Cursor&quot;</span><span class="p">,</span> <span class="s2">&quot;Cursors&quot;</span><span class="p">,</span> <span class="s2">&quot;CursorsM&quot;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">_CursorData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is the shared data class that holds all of the data</span>
<span class="sd">    for a Cursor. This is held by all Cursors that are derived</span>
<span class="sd">    from the same object, meaning that multiple Cursors</span>
<span class="sd">    can share the same molecule editor. Note that the</span>
<span class="sd">    Cursor is not thread-safe (unlike the underlying</span>
<span class="sd">    system used by Sire)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">molecule</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity_property</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>

        <span class="kn">from</span> <span class="nn">..base</span> <span class="kn">import</span> <span class="n">create_map</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="n">create_map</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity_property</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;connectivity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">source</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity_property</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># we cannot support value-based connectivity properties</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;connectivity&quot;</span><span class="p">,</span> <span class="s2">&quot;connectivity&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity_property</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;connectivity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">source</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">property</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connectivity_property</span>
            <span class="p">)</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># the molecule doesn&#39;t have a connectivity. Create one for it</span>
            <span class="kn">from</span> <span class="nn">..legacy.Mol</span> <span class="kn">import</span> <span class="n">CovalentBondHunter</span>

            <span class="n">hunter</span> <span class="o">=</span> <span class="n">CovalentBondHunter</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">connectivity</span> <span class="o">=</span> <span class="n">hunter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connectivity_property</span><span class="p">,</span> <span class="n">connectivity</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="n">connectivity</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">Console</span>

                <span class="n">Console</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot auto-generate a connectivity for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; The error is:</span><span class="se">\n\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the molnum number of the molecule being edited</span>
<span class="sd">        by this cursor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">number</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">map</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a property map that is the combination</span>
<span class="sd">        of self.map and the passed map. The properties</span>
<span class="sd">        set in the passed map have precedence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_internal_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">internal</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">remove_property</span><span class="p">(</span><span class="n">internal</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity_property</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_internal_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">internal</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_internal_property</span><span class="p">(</span><span class="n">internal</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="n">internal</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connectivity_property</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_internal_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">internal</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">remove_property</span><span class="p">(</span><span class="n">internal</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="n">internal</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity_property</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="p">[</span><span class="n">view</span><span class="o">.</span><span class="n">index</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span>


<span class="n">_default_process_map</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">_weightfuncs</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">_process_move_options</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">anchor</span><span class="p">,</span> <span class="n">weighting</span><span class="p">,</span> <span class="nb">map</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Internal function used to process the passed move options</span>
<span class="sd">    and return a property map with those options set.</span>

<span class="sd">    The default is to have no anchors and to have</span>
<span class="sd">    the AbsFromNumber weighting (this is defined</span>
<span class="sd">    in weightfunction.h in the C++ layer).</span>

<span class="sd">    Here we convert the weighting (as a string option)</span>
<span class="sd">    into a WeightFunction, plus we convert the anchor</span>
<span class="sd">    (as a view and then selection into that view) into</span>
<span class="sd">    an AtomSelection object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_default_process_map</span>

    <span class="k">if</span> <span class="n">_default_process_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">..base</span> <span class="kn">import</span> <span class="n">PropertyMap</span>
        <span class="kn">from</span> <span class="nn">..legacy.Mol</span> <span class="kn">import</span> <span class="n">AbsFromMass</span>

        <span class="n">_default_process_map</span> <span class="o">=</span> <span class="n">PropertyMap</span><span class="p">()</span>
        <span class="n">_default_process_map</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;weight function&quot;</span><span class="p">,</span> <span class="n">AbsFromMass</span><span class="p">())</span>

    <span class="k">if</span> <span class="nb">map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">map</span> <span class="o">=</span> <span class="n">_default_process_map</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">map</span> <span class="o">=</span> <span class="n">_default_process_map</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">anchor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="n">view</span><span class="p">[</span><span class="n">anchor</span><span class="p">]</span><span class="o">.</span><span class="n">selection</span><span class="p">()</span>
            <span class="nb">map</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;anchors&quot;</span><span class="p">,</span> <span class="n">selection</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">Console</span>

            <span class="n">Console</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to find anchors &#39;</span><span class="si">{</span><span class="n">anchor</span><span class="si">}</span><span class="s2">&#39;.</span><span class="se">\n\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">weighting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">global</span> <span class="n">_weightfuncs</span>

        <span class="k">if</span> <span class="n">_weightfuncs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..legacy.Mol</span> <span class="kn">import</span> <span class="p">(</span>
                <span class="n">AbsFromMass</span><span class="p">,</span>
                <span class="n">RelFromMass</span><span class="p">,</span>
                <span class="n">AbsFromNumber</span><span class="p">,</span>
                <span class="n">RelFromNumber</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">_weightfuncs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;relative_mass&quot;</span><span class="p">:</span> <span class="n">RelFromMass</span><span class="p">,</span>
                <span class="s2">&quot;absolute_mass&quot;</span><span class="p">:</span> <span class="n">AbsFromMass</span><span class="p">,</span>
                <span class="s2">&quot;relative_number&quot;</span><span class="p">:</span> <span class="n">RelFromNumber</span><span class="p">,</span>
                <span class="s2">&quot;absolute_number&quot;</span><span class="p">:</span> <span class="n">AbsFromNumber</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">weighting</span> <span class="o">=</span> <span class="n">_weightfuncs</span><span class="p">[</span><span class="n">weighting</span><span class="p">]()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unsupported weighting: </span><span class="si">{</span><span class="n">weighting</span><span class="si">}</span><span class="s2">. Supported values &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;are </span><span class="si">{</span><span class="n">_weightfuncs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="nb">map</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;weight function&quot;</span><span class="p">,</span> <span class="n">weighting</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">map</span>


<div class="viewcode-block" id="Cursor"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor">[docs]</a><span class="k">class</span> <span class="nc">Cursor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class provides a cursor that can be used to navigate through</span>
<span class="sd">    and edit the properties of Molecules. This makes the whole</span>
<span class="sd">    getting and setting of properties more pythonic in writing</span>
<span class="sd">    style, while also saving some typing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">internal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct the Cursor to explore and edit the</span>
<span class="sd">        properties of the passed MoleculeView.</span>

<span class="sd">        Note that you normally don&#39;t call this yourself.</span>
<span class="sd">        Instead, you would create a Cursor by calling</span>
<span class="sd">        the `.cursor()` function on the molecule view</span>
<span class="sd">        itself.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; cursor = mol.cursor()</span>
<span class="sd">            &gt;&gt;&gt; cursor[&quot;cat&quot;] = &quot;meow&quot;</span>
<span class="sd">            &gt;&gt;&gt; mol = cursor.commit()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="n">_CursorData</span><span class="p">(</span><span class="n">molecule</span><span class="o">=</span><span class="n">molecule</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">molecule</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">molecule</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">internal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">what</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">w</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;Bond&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">w</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;Angle&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">w</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;Dihedral&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">w</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;Dihedral&quot;</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">internal</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_internal</span> <span class="o">=</span> <span class="n">internal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Cursor::null&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
            <span class="c1"># This is an Internal Cursor</span>
            <span class="n">a0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">atom0</span><span class="p">()]</span>
            <span class="n">a1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">atom1</span><span class="p">()]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bond</span><span class="p">():</span>
                <span class="k">return</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cursor(bond, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a0</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">a0</span><span class="o">.</span><span class="n">number</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2"> =&gt; &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a1</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">a1</span><span class="o">.</span><span class="n">number</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_angle</span><span class="p">():</span>
                <span class="n">a2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">atom2</span><span class="p">()]</span>
                <span class="k">return</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cursor(angle, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a0</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">a0</span><span class="o">.</span><span class="n">number</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2"> &lt;= &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a1</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">a1</span><span class="o">.</span><span class="n">number</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2"> =&gt; &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a2</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">a2</span><span class="o">.</span><span class="n">number</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">atom2</span><span class="p">()]</span>
                <span class="n">a3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">atom3</span><span class="p">()]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dihedral</span><span class="p">():</span>
                    <span class="k">return</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Cursor(dihedral, &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a0</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">a0</span><span class="o">.</span><span class="n">number</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2"> &lt;= &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a1</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">a1</span><span class="o">.</span><span class="n">number</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2"> == &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a2</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">a2</span><span class="o">.</span><span class="n">number</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2"> =&gt; &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a3</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">a3</span><span class="o">.</span><span class="n">number</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Cursor(improper, &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a0</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">a0</span><span class="o">.</span><span class="n">number</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2"> =&gt; &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a1</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">a1</span><span class="o">.</span><span class="n">number</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2"> == &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a2</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">a2</span><span class="o">.</span><span class="n">number</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2"> &lt;= &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a3</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">a3</span><span class="o">.</span><span class="n">number</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This is a view cursor</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Cursor(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Cursor(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete the property with specified key&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">remove_internal_property</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_molecule</span><span class="p">():</span>
                <span class="c1"># remove the property entirely</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">remove_property</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># replace the property with a default-constructed value</span>
                <span class="bp">self</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether a property with the specified key is</span>
<span class="sd">        contained in this view.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">has_property</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">has_property</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a cursor that represents the sub-view of this</span>
<span class="sd">        cursor, indexed by key. For example,</span>
<span class="sd">        cursor(&quot;element C&quot;) would return a cursor for all</span>
<span class="sd">        of the carbon atoms in this view.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">()[</span><span class="n">key</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">is_selector</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the property that matches the passed key, OR the</span>
<span class="sd">        sub-view that matches the key. This will only look for</span>
<span class="sd">        the sub-view if there is no matching property. Use</span>
<span class="sd">        the __call__ function if you only want to search for</span>
<span class="sd">        sub-views.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">property_error</span> <span class="o">=</span> <span class="n">e</span>

        <span class="c1"># We can&#39;t find the property so try the sub-view</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># We can&#39;t find the sub-view, but since this searches the</span>
        <span class="c1"># property first, we will raise the property exception</span>
        <span class="k">raise</span> <span class="n">property_error</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the property with key &#39;key&#39; to the passed &#39;value&#39;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">set_internal_property</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># we need to create a default-constructed value</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="c1"># No existing property - assume this is Boolean False</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_add_bond_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal function used to add member functions that are</span>
<span class="sd">        specific only to cursors that operate on bonds</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">get_length</span><span class="p">(</span><span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Return the length of the bond being edited by this cursor&quot;&quot;&quot;</span>
            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">()</span><span class="o">.</span><span class="n">length</span><span class="p">(</span><span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">set_length</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Set the length of the bond being edited by this cursor to</span>
<span class="sd">            &#39;value&#39;. This should be either a length unit, or a float</span>
<span class="sd">            (in which case it is converted into a value with default</span>
<span class="sd">            length units)</span>

<span class="sd">             value: float or length</span>
<span class="sd">                 The length to which to set this bond.</span>

<span class="sd">             anchor: string or ID</span>
<span class="sd">                 The search or ID to identify atoms in the view that</span>
<span class="sd">                 are anchored, and which cannot be moved when the</span>
<span class="sd">                 internal is set.</span>

<span class="sd">             weighting: string</span>
<span class="sd">                 The weighting function used to distribute the move</span>
<span class="sd">                 across the atoms in the view. This is either;</span>
<span class="sd">                 &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                 &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                 to &#39;absolute_number&#39;</span>

<span class="sd">             auto_align: bool</span>
<span class="sd">                 Whether or not to align the molecule against itself</span>
<span class="sd">                 after the move</span>

<span class="sd">             map: sire.base.PropertyMap or dict</span>
<span class="sd">                 Map of property keys that are passed through to</span>
<span class="sd">                 control which properties are used for the move,</span>
<span class="sd">                 plus fine-grained control of the weight function</span>
<span class="sd">                 or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="kn">from</span> <span class="nn">..units</span> <span class="kn">import</span> <span class="n">length</span>

            <span class="n">value</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

            <span class="nb">map</span> <span class="o">=</span> <span class="n">_process_move_options</span><span class="p">(</span>
                <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="nb">map</span>
            <span class="p">)</span>
            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>

            <span class="n">moved</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">move</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">auto_align</span> <span class="ow">and</span> <span class="p">(</span><span class="n">anchor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">moved</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">moved</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">def</span> <span class="nf">change_length</span><span class="p">(</span>
            <span class="n">delta</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Change the length of the bond being edited by this cursor by</span>
<span class="sd">            &#39;delta&#39;. This should be either a length unit, or a float</span>
<span class="sd">            (in which case it is converted into a value with default</span>
<span class="sd">            length units)</span>

<span class="sd">             delta: float or length</span>
<span class="sd">                 The length by which to change this bond.</span>

<span class="sd">             anchor: string or ID</span>
<span class="sd">                 The search or ID to identify atoms in the view that</span>
<span class="sd">                 are anchored, and which cannot be moved when the</span>
<span class="sd">                 internal is set.</span>

<span class="sd">             weighting: string</span>
<span class="sd">                 The weighting function used to distribute the move</span>
<span class="sd">                 across the atoms in the view. This is either;</span>
<span class="sd">                 &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                 &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                 to &#39;absolute_number&#39;</span>

<span class="sd">             auto_align: bool</span>
<span class="sd">                 Whether or not to align the molecule against itself</span>
<span class="sd">                 after the move</span>

<span class="sd">             map: sire.base.PropertyMap or dict</span>
<span class="sd">                 Map of property keys that are passed through to</span>
<span class="sd">                 control which properties are used for the move,</span>
<span class="sd">                 plus fine-grained control of the weight function</span>
<span class="sd">                 or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="kn">from</span> <span class="nn">..units</span> <span class="kn">import</span> <span class="n">length</span>

            <span class="n">delta</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>

            <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

            <span class="nb">map</span> <span class="o">=</span> <span class="n">_process_move_options</span><span class="p">(</span>
                <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="nb">map</span>
            <span class="p">)</span>
            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>

            <span class="n">moved</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">move</span><span class="p">()</span><span class="o">.</span><span class="n">change</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">auto_align</span> <span class="ow">and</span> <span class="p">(</span><span class="n">anchor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">moved</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">moved</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

            <span class="k">return</span> <span class="bp">self</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">get_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_length</span> <span class="o">=</span> <span class="n">set_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_length</span> <span class="o">=</span> <span class="n">change_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="n">get_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_measure</span> <span class="o">=</span> <span class="n">set_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_measure</span> <span class="o">=</span> <span class="n">change_length</span>

    <span class="k">def</span> <span class="nf">_add_angle_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal function used to add member functions that are</span>
<span class="sd">        specific only to cursors that operate on angles, dihedrals</span>
<span class="sd">        or impropers</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">get_size</span><span class="p">(</span><span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Return the size of the internal being edited by this cursor&quot;&quot;&quot;</span>
            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">set_size</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span>
            <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">move_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Set the size of the internal being edited by this cursor to</span>
<span class="sd">            &#39;delta&#39;. This should be either an angle unit, or a float</span>
<span class="sd">            (in which case it is converted into a value with default</span>
<span class="sd">             angle units)</span>

<span class="sd">             value: float or angle</span>
<span class="sd">                 The angle to which to set this internal.</span>

<span class="sd">             anchor: string or ID</span>
<span class="sd">                 The search or ID to identify atoms in the view that</span>
<span class="sd">                 are anchored, and which cannot be moved when the</span>
<span class="sd">                 internal is set.</span>

<span class="sd">             weighting: string</span>
<span class="sd">                 The weighting function used to distribute the move</span>
<span class="sd">                 across the atoms in the view. This is either;</span>
<span class="sd">                 &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                 &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                 to &#39;absolute_number&#39;</span>

<span class="sd">             auto_align: bool</span>
<span class="sd">                 Whether or not to align the molecule against itself</span>
<span class="sd">                 after the move</span>

<span class="sd">             move_all: bool</span>
<span class="sd">                 Option only used for dihedrals. Whether or not to</span>
<span class="sd">                 move all atoms around the dihedral or just the</span>
<span class="sd">                 specified dihedral</span>

<span class="sd">             map: sire.base.PropertyMap or dict</span>
<span class="sd">                 Map of property keys that are passed through to</span>
<span class="sd">                 control which properties are used for the move,</span>
<span class="sd">                 plus fine-grained control of the weight function</span>
<span class="sd">                 or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="kn">from</span> <span class="nn">..units</span> <span class="kn">import</span> <span class="n">angle</span>

            <span class="n">value</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

            <span class="nb">map</span> <span class="o">=</span> <span class="n">_process_move_options</span><span class="p">(</span>
                <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="nb">map</span>
            <span class="p">)</span>

            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">move_all</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dihedral</span><span class="p">():</span>
                <span class="n">moved</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">move</span><span class="p">()</span><span class="o">.</span><span class="n">set_all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">moved</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">move</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">auto_align</span> <span class="ow">and</span> <span class="p">(</span><span class="n">anchor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">moved</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">moved</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">def</span> <span class="nf">change_size</span><span class="p">(</span>
            <span class="n">delta</span><span class="p">,</span>
            <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">move_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Change the size of the internal being edited by this cursor by</span>
<span class="sd">            &#39;delta&#39;. This should be either an angle unit, or a float</span>
<span class="sd">            (in which case it is converted into a value with default</span>
<span class="sd">             angle units)</span>

<span class="sd">             delta: float or angle</span>
<span class="sd">                 The angle by which this internal is changed.</span>

<span class="sd">             anchor: string or ID</span>
<span class="sd">                 The search or ID to identify atoms in the view that</span>
<span class="sd">                 are anchored, and which cannot be moved when the</span>
<span class="sd">                 internal is set.</span>

<span class="sd">             weighting: string</span>
<span class="sd">                 The weighting function used to distribute the move</span>
<span class="sd">                 across the atoms in the view. This is either;</span>
<span class="sd">                 &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                 &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                 to &#39;absolute_number&#39;</span>

<span class="sd">             auto_align: bool</span>
<span class="sd">                 Whether or not to align the molecule against itself</span>
<span class="sd">                 after the move</span>

<span class="sd">             move_all: bool</span>
<span class="sd">                 Option only used for dihedrals. Whether or not to</span>
<span class="sd">                 move all atoms around the dihedral or just the</span>
<span class="sd">                 specified dihedral</span>

<span class="sd">             map: sire.base.PropertyMap or dict</span>
<span class="sd">                 Map of property keys that are passed through to</span>
<span class="sd">                 control which properties are used for the move,</span>
<span class="sd">                 plus fine-grained control of the weight function</span>
<span class="sd">                 or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="kn">from</span> <span class="nn">..units</span> <span class="kn">import</span> <span class="n">angle</span>

            <span class="n">delta</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
            <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

            <span class="nb">map</span> <span class="o">=</span> <span class="n">_process_move_options</span><span class="p">(</span>
                <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="nb">map</span>
            <span class="p">)</span>

            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">move_all</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dihedral</span><span class="p">():</span>
                <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">BondID</span>

                <span class="n">center_bond</span> <span class="o">=</span> <span class="n">BondID</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">atom1</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">atom2</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">moved</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">move</span><span class="p">()</span><span class="o">.</span><span class="n">change</span><span class="p">(</span><span class="n">center_bond</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">moved</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">move</span><span class="p">()</span><span class="o">.</span><span class="n">change</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">auto_align</span> <span class="ow">and</span> <span class="p">(</span><span class="n">anchor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">moved</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">moved</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">get_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_size</span> <span class="o">=</span> <span class="n">set_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_size</span> <span class="o">=</span> <span class="n">change_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="n">get_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_measure</span> <span class="o">=</span> <span class="n">set_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_measure</span> <span class="o">=</span> <span class="n">change_size</span>

    <span class="k">def</span> <span class="nf">_add_extra_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal function that adds additional functions to this</span>
<span class="sd">        cursor depending on what type of object is being edited.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bond</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_bond_functions</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_angle_functions</span><span class="p">()</span>

<div class="viewcode-block" id="Cursor.is_same_editor"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.is_same_editor">[docs]</a>    <span class="k">def</span> <span class="nf">is_same_editor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether this Cursor is using the same editor to edit</span>
<span class="sd">        the molecule as &#39;other&#39;. This returns true if the underlying</span>
<span class="sd">        editor for both cursors is the same, i.e. changes made by</span>
<span class="sd">        one cursor would be seen and be editable by the other cursor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Other is a Cursor</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="n">_d</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Other is a Cursors</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_d</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c1"># Other is something else (a CursorsM?)</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Cursor.bonds"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.bonds">[docs]</a>    <span class="k">def</span> <span class="nf">bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of the bonds in this</span>
<span class="sd">        view or, if &#39;id&#39; is supplied, the bonds in this</span>
<span class="sd">        view that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="n">cursors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">bonds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">()</span><span class="o">.</span><span class="n">bonds</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">bonds</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_internal</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>
            <span class="n">cursors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Cursors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursors</span><span class="p">,</span> <span class="n">bonds</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cursor.angles"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.angles">[docs]</a>    <span class="k">def</span> <span class="nf">angles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of the angles in this</span>
<span class="sd">        view or, if &#39;id&#39; is supplied, the angles in this</span>
<span class="sd">        view that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="n">cursors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">angles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">()</span><span class="o">.</span><span class="n">angles</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_internal</span> <span class="o">=</span> <span class="n">angle</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>
            <span class="n">cursors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Cursors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursors</span><span class="p">,</span> <span class="n">angles</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cursor.dihedrals"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.dihedrals">[docs]</a>    <span class="k">def</span> <span class="nf">dihedrals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of the dihedrals in this</span>
<span class="sd">        view or, if &#39;id&#39; is supplied, the dihedrals in this</span>
<span class="sd">        view that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="n">cursors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">dihedrals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">()</span><span class="o">.</span><span class="n">dihedrals</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">dihedral</span> <span class="ow">in</span> <span class="n">dihedrals</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_internal</span> <span class="o">=</span> <span class="n">dihedral</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>
            <span class="n">cursors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Cursors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursors</span><span class="p">,</span> <span class="n">dihedrals</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cursor.impropers"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.impropers">[docs]</a>    <span class="k">def</span> <span class="nf">impropers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of the impropers in this</span>
<span class="sd">        view or, if &#39;id&#39; is supplied, the impropers in this</span>
<span class="sd">        view that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="n">cursors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">impropers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">()</span><span class="o">.</span><span class="n">impropers</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">improper</span> <span class="ow">in</span> <span class="n">impropers</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_internal</span> <span class="o">=</span> <span class="n">improper</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>
            <span class="n">cursors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Cursors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursors</span><span class="p">,</span> <span class="n">impropers</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Hidden function that allows a single view of the</span>
<span class="sd">        current molecule to be converted to a Cursor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">is_same_molecule</span><span class="p">(</span><span class="n">view</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;You cannot create from this view (</span><span class="si">{</span><span class="n">view</span><span class="si">}</span><span class="s2">) as it is from &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;a different molecule to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>

        <span class="kn">from</span> <span class="nn">..mm</span> <span class="kn">import</span> <span class="n">Bond</span><span class="p">,</span> <span class="n">Angle</span><span class="p">,</span> <span class="n">Dihedral</span><span class="p">,</span> <span class="n">Improper</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">Molecule</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">view</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Molecule</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">view</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Bond</span><span class="p">,</span> <span class="n">Angle</span><span class="p">,</span> <span class="n">Dihedral</span><span class="p">,</span> <span class="n">Improper</span><span class="p">]:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_internal</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="p">[</span><span class="n">view</span><span class="o">.</span><span class="n">index</span><span class="p">()]</span>

        <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">c</span>

    <span class="k">def</span> <span class="nf">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">views</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Hidden function that allows a set of views, e.g. from</span>
<span class="sd">        a Selector_Atom_, SelectorBond etc, to be converted</span>
<span class="sd">        to a set of Cursors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cursors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="kn">from</span> <span class="nn">..mm</span> <span class="kn">import</span> <span class="n">Bond</span><span class="p">,</span> <span class="n">Angle</span><span class="p">,</span> <span class="n">Dihedral</span><span class="p">,</span> <span class="n">Improper</span>

        <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">views</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>

            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">view</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Bond</span><span class="p">,</span> <span class="n">Angle</span><span class="p">,</span> <span class="n">Dihedral</span><span class="p">,</span> <span class="n">Improper</span><span class="p">]:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_internal</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># likely an atom, residue, chain or segment</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="p">[</span><span class="n">view</span><span class="o">.</span><span class="n">index</span><span class="p">()]</span>

            <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>

            <span class="n">cursors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Cursors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursors</span><span class="p">,</span> <span class="n">views</span><span class="p">)</span>

<div class="viewcode-block" id="Cursor.atoms"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.atoms">[docs]</a>    <span class="k">def</span> <span class="nf">atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of atoms in this view,</span>
<span class="sd">        of, if &#39;id&#39; is supplied, the atoms in this view</span>
<span class="sd">        that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cursors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">atoms</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">atoms</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">atoms</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">atoms</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">atom</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">index</span><span class="p">())</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>
            <span class="n">cursors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Cursors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursors</span><span class="p">,</span> <span class="n">atoms</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cursor.residues"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.residues">[docs]</a>    <span class="k">def</span> <span class="nf">residues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of residues in this view,</span>
<span class="sd">        of, if &#39;id&#39; is supplied, the residues in this view</span>
<span class="sd">        that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cursors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">residues</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">residues</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">residues</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">residues</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">residue</span><span class="p">(</span><span class="n">residue</span><span class="o">.</span><span class="n">index</span><span class="p">())</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>
            <span class="n">cursors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Cursors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursors</span><span class="p">,</span> <span class="n">residues</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cursor.chains"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.chains">[docs]</a>    <span class="k">def</span> <span class="nf">chains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of chains in this view,</span>
<span class="sd">        of, if &#39;id&#39; is supplied, the chains in this view</span>
<span class="sd">        that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cursors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">chains</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">chains</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">chains</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">chains</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">index</span><span class="p">())</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>
            <span class="n">cursors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Cursors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursors</span><span class="p">,</span> <span class="n">chains</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cursor.segments"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.segments">[docs]</a>    <span class="k">def</span> <span class="nf">segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of segments in this view,</span>
<span class="sd">        of, if &#39;id&#39; is supplied, the segments in this view</span>
<span class="sd">        that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cursors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">segments</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">segments</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">segments</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">segments</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">index</span><span class="p">())</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>
            <span class="n">cursors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Cursors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursors</span><span class="p">,</span> <span class="n">segments</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cursor.atom"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.atom">[docs]</a>    <span class="k">def</span> <span class="nf">atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the atom in the molecule that matches the passed ID&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">atom</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">c</span></div>

<div class="viewcode-block" id="Cursor.residue"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.residue">[docs]</a>    <span class="k">def</span> <span class="nf">residue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the residue in the molecule that matches the passed ID.</span>
<span class="sd">        If &#39;i&#39; is None, then this returns the residue that contains</span>
<span class="sd">        this atom (if this is an atom)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">residue</span><span class="p">()</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">c</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;There is no residue that contains </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span><span class="si">}</span><span class="s2">:&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">residue</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">c</span></div>

<div class="viewcode-block" id="Cursor.chain"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.chain">[docs]</a>    <span class="k">def</span> <span class="nf">chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the chain in the molecule that matches the passed ID.</span>
<span class="sd">        If &#39;i&#39; is None, then this returns the chain that contains</span>
<span class="sd">        this atom (if this is an atom)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">chain</span><span class="p">()</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">c</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;There is no chain that contains </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span><span class="si">}</span><span class="s2">:&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">c</span></div>

<div class="viewcode-block" id="Cursor.segment"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.segment">[docs]</a>    <span class="k">def</span> <span class="nf">segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the segment in the molecule that matches the passed ID.</span>
<span class="sd">        If &#39;i&#39; is None, then this returns the segment that contains</span>
<span class="sd">        this atom (if this is an atom)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">segment</span><span class="p">()</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">c</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;There is no segment that contains </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span><span class="si">}</span><span class="s2">:&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">c</span></div>

<div class="viewcode-block" id="Cursor.molecule"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.molecule">[docs]</a>    <span class="k">def</span> <span class="nf">molecule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the molecule&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">c</span></div>

<div class="viewcode-block" id="Cursor.bond"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.bond">[docs]</a>    <span class="k">def</span> <span class="nf">bond</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the Cursor for the specified bond.&quot;&quot;&quot;</span>
        <span class="n">bond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">()</span><span class="o">.</span><span class="n">bond</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_internal</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">c</span></div>

<div class="viewcode-block" id="Cursor.angle"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.angle">[docs]</a>    <span class="k">def</span> <span class="nf">angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the Cursor for the specified angle.&quot;&quot;&quot;</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">()</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_internal</span> <span class="o">=</span> <span class="n">angle</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">c</span></div>

<div class="viewcode-block" id="Cursor.dihedral"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.dihedral">[docs]</a>    <span class="k">def</span> <span class="nf">dihedral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the Cursor for the specified dihedral.&quot;&quot;&quot;</span>
        <span class="n">dihedral</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">()</span><span class="o">.</span><span class="n">dihedral</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_internal</span> <span class="o">=</span> <span class="n">dihedral</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">c</span></div>

<div class="viewcode-block" id="Cursor.improper"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.improper">[docs]</a>    <span class="k">def</span> <span class="nf">improper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the Cursor for the specified improper.&quot;&quot;&quot;</span>
        <span class="n">improper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">()</span><span class="o">.</span><span class="n">improper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_internal</span> <span class="o">=</span> <span class="n">improper</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">c</span></div>

<div class="viewcode-block" id="Cursor.parent"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.parent">[docs]</a>    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the cursor of the parent object (e.g. parent residue</span>
<span class="sd">        of the atom, parent chain of the residue, parent molecule</span>
<span class="sd">        of the bond etc. This will return the Cursor for the whole</span>
<span class="sd">        molecule if there isn&#39;t a suitable parent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>

        <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span>

        <span class="c1"># The parent of an Atom is a Residue (if it is in one), and</span>
        <span class="c1"># the parent of a Residue is a Chain (if it is in one).</span>
        <span class="c1"># If this fails, then the parent is the Molecule</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">residue</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="s2">&quot;residue&quot;</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">chain</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">c</span></div>

<div class="viewcode-block" id="Cursor.get"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the property associated with key &#39;key&#39;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cursor.set"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the property associated with key &#39;key&#39; to the</span>
<span class="sd">        passed value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Cursor.delete"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the property associated with the key &#39;key&#39;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Cursor.get_name"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the name of the current view. Note that this</span>
<span class="sd">        returns the name as a simple string (it is not a</span>
<span class="sd">        AtomName, ResName etc)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;An internal (bond/angle/dihedral/improper) does not have &quot;</span>
                <span class="s2">&quot;a name!&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cursor.set_name"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.set_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the name of the object in the current view&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;An internal (bond/angle/dihedral/improper) does not have &quot;</span>
                <span class="s2">&quot;a name!&quot;</span>
            <span class="p">)</span>

        <span class="c1"># get the type right...</span>
        <span class="n">orig_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">orig_name</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Cursor.get_number"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.get_number">[docs]</a>    <span class="k">def</span> <span class="nf">get_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of the current view. This returns the</span>
<span class="sd">        number as a simple number (it is not a AtomNum, ResNum etc)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;An internal (bond/angle/dihedral/improper) does not have &quot;</span>
                <span class="s2">&quot;a number!&quot;</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">number</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">what</span><span class="p">()</span><span class="si">}</span><span class="s2"> does not have a number!&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cursor.set_number"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.set_number">[docs]</a>    <span class="k">def</span> <span class="nf">set_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the number of the object in the current view&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;An internal (bond/angle/dihedral/improper) does not have &quot;</span>
                <span class="s2">&quot;a number!&quot;</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">orig_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">number</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">renumber</span><span class="p">(</span><span class="n">orig_number</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">number</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">what</span><span class="p">()</span><span class="si">}</span><span class="s2"> does not have a number!&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Cursor.get_index"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.get_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the index of the current view. This returns it as</span>
<span class="sd">        as simple number (i.e. not as an AtomIdx, ResIdx etc)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;An internal (bond/angle/dihedral/improper) does not have &quot;</span>
                <span class="s2">&quot;an index!&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">index</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span></div>

    <span class="n">name</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_name</span><span class="p">,</span> <span class="n">set_name</span><span class="p">)</span>
    <span class="n">number</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_number</span><span class="p">,</span> <span class="n">set_number</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_index</span><span class="p">)</span>

<div class="viewcode-block" id="Cursor.id"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.id">[docs]</a>    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the ID of this view (e.g. AtomIdx, MolNum, BondID)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">index</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># objects without an index (e.g. molecule)</span>
            <span class="c1"># use a number for their ID</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">number</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cursor.type"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.type">[docs]</a>    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the type of this Cursor (e.g. &#39;atom&#39;, &#39;bond&#39;,</span>
<span class="sd">        &#39;residue&#39;, &#39;chain&#39;, &#39;segment&#39; or &#39;molecule&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bond</span><span class="p">():</span>
                <span class="k">return</span> <span class="s2">&quot;bond&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_angle</span><span class="p">():</span>
                <span class="k">return</span> <span class="s2">&quot;angle&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dihedral</span><span class="p">():</span>
                <span class="k">return</span> <span class="s2">&quot;dihedral&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_improper</span><span class="p">():</span>
                <span class="k">return</span> <span class="s2">&quot;improper&quot;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">what</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Atom&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;atom&quot;</span>
        <span class="k">elif</span> <span class="n">w</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Res&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;residue&quot;</span>
        <span class="k">elif</span> <span class="n">w</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Chain&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;chain&quot;</span>
        <span class="k">elif</span> <span class="n">w</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Seg&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;segment&quot;</span>
        <span class="k">elif</span> <span class="n">w</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Mol&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;molecule&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot identify cursor type </span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cursor.is_molecule"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.is_molecule">[docs]</a>    <span class="k">def</span> <span class="nf">is_molecule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether this is pointing to a Molecule&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;molecule&quot;</span></div>

<div class="viewcode-block" id="Cursor.is_internal"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.is_internal">[docs]</a>    <span class="k">def</span> <span class="nf">is_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether or not this is a view of an internal</span>
<span class="sd">        (i.e. bond, angle, dihedral or improper)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Cursor.is_bond"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.is_bond">[docs]</a>    <span class="k">def</span> <span class="nf">is_bond</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether this is pointing to a Bond&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">BondID</span>

        <span class="k">return</span> <span class="n">BondID</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">)</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cursor.is_angle"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.is_angle">[docs]</a>    <span class="k">def</span> <span class="nf">is_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether this is pointing to an Angle&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">AngleID</span>

        <span class="k">return</span> <span class="n">AngleID</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">)</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cursor.is_dihedral"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.is_dihedral">[docs]</a>    <span class="k">def</span> <span class="nf">is_dihedral</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether this is pointing to a Dihedral&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">DihedralID</span>

        <span class="k">return</span> <span class="n">DihedralID</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">)</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cursor.is_improper"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.is_improper">[docs]</a>    <span class="k">def</span> <span class="nf">is_improper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether this is pointing to an Improper&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ImproperID</span>

        <span class="k">return</span> <span class="n">ImproperID</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">)</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cursor.is_atom"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.is_atom">[docs]</a>    <span class="k">def</span> <span class="nf">is_atom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether this is pointing to an Atom&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span></div>

<div class="viewcode-block" id="Cursor.is_residue"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.is_residue">[docs]</a>    <span class="k">def</span> <span class="nf">is_residue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether this is pointing to a Residue&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;residue&quot;</span></div>

<div class="viewcode-block" id="Cursor.is_chain"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.is_chain">[docs]</a>    <span class="k">def</span> <span class="nf">is_chain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether this is pointing to a Chain&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;chain&quot;</span></div>

<div class="viewcode-block" id="Cursor.is_segment"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.is_segment">[docs]</a>    <span class="k">def</span> <span class="nf">is_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether this is pointing to a Segment&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;segment&quot;</span></div>

<div class="viewcode-block" id="Cursor.evaluate"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a :class:`sire.mol.Evaluator` for the view</span>
<span class="sd">        in this cursor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bond</span><span class="p">():</span>
                <span class="kn">from</span> <span class="nn">..mm</span> <span class="kn">import</span> <span class="n">Bond</span>

                <span class="k">return</span> <span class="n">Bond</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_angle</span><span class="p">():</span>
                <span class="kn">from</span> <span class="nn">..mm</span> <span class="kn">import</span> <span class="n">Angle</span>

                <span class="k">return</span> <span class="n">Angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dihedral</span><span class="p">():</span>
                <span class="kn">from</span> <span class="nn">..mm</span> <span class="kn">import</span> <span class="n">Dihedral</span>

                <span class="k">return</span> <span class="n">Dihedral</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_improper</span><span class="p">():</span>
                <span class="kn">from</span> <span class="nn">..mm</span> <span class="kn">import</span> <span class="n">Improper</span>

                <span class="k">return</span> <span class="n">Improper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cursor.view"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.view">[docs]</a>    <span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the view underpinning this cursor. This is actually</span>
<span class="sd">        the same as committing the changes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cursor.commit"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.commit">[docs]</a>    <span class="k">def</span> <span class="nf">commit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Commit all of the changes and return the newly</span>
<span class="sd">        edited molecule (or MoleculeView)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bond</span><span class="p">():</span>
                <span class="kn">from</span> <span class="nn">..mm</span> <span class="kn">import</span> <span class="n">Bond</span>

                <span class="k">return</span> <span class="n">Bond</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_angle</span><span class="p">():</span>
                <span class="kn">from</span> <span class="nn">..mm</span> <span class="kn">import</span> <span class="n">Angle</span>

                <span class="k">return</span> <span class="n">Angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dihedral</span><span class="p">():</span>
                <span class="kn">from</span> <span class="nn">..mm</span> <span class="kn">import</span> <span class="n">Dihedral</span>

                <span class="k">return</span> <span class="n">Dihedral</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_improper</span><span class="p">():</span>
                <span class="kn">from</span> <span class="nn">..mm</span> <span class="kn">import</span> <span class="n">Improper</span>

                <span class="k">return</span> <span class="n">Improper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mol</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">index</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mol</span></div>

<div class="viewcode-block" id="Cursor.apply"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply the passed function (with optional position and keyword</span>
<span class="sd">        arguments) to this Cursor. As the function is intended to use</span>
<span class="sd">        the Cursor to edit molecules, only this Cursor will be returned.</span>
<span class="sd">        This lets you run `.apply(...).commit()` as a single line.</span>

<span class="sd">        The function can be either;</span>

<span class="sd">        1. a string containing the name of the function to call, or</span>
<span class="sd">        2. an actual function (either a normal function or a lambda expression)</span>

<span class="sd">        You can optionally pass in positional and keyword arguments</span>
<span class="sd">        here that will be passed to the function.</span>

<span class="sd">        Args:</span>
<span class="sd">            func (str or function): The function to be called, or the name</span>
<span class="sd">                                    of the function to be called.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Cursor: This cursor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="o">==</span> <span class="n">func</span><span class="p">:</span>
            <span class="c1"># we calling a named function</span>
            <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>

        <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">property_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">property_keys</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">property_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">property_values</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">vals</span>

    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">property_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">property_keys</span><span class="p">()</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">items</span>

<div class="viewcode-block" id="Cursor.properties"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.properties">[docs]</a>    <span class="k">def</span> <span class="nf">properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the sire.base.Properties object for the properties</span>
<span class="sd">        of the current view</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">..legacy.Base</span> <span class="kn">import</span> <span class="n">Properties</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">Properties</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="Cursor.num_frames"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.num_frames">[docs]</a>    <span class="k">def</span> <span class="nf">num_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of trajectory frames contained by the molecule&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">num_frames</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cursor.load_frame"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.load_frame">[docs]</a>    <span class="k">def</span> <span class="nf">load_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call the `load_frame` function on the contained view, passing</span>
<span class="sd">        the arguments directly. This is equivalent to calling</span>
<span class="sd">        `load_frame` directly on the contained view.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">load_frame</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Cursor.save_frame"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.save_frame">[docs]</a>    <span class="k">def</span> <span class="nf">save_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call the `save_frame` function on the contained view, passing</span>
<span class="sd">        the arguments directly. This is equivalent to calling</span>
<span class="sd">        `save_frame` directly on the contained view.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">save_frame</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Cursor.delete_frame"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.delete_frame">[docs]</a>    <span class="k">def</span> <span class="nf">delete_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call the `delete_frame` function on the contained view, passing</span>
<span class="sd">        the arguments directly. This is equivalent to calling</span>
<span class="sd">        `delete_frame` directly on the contained view.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">delete_frame</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Cursor.translate"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Translate all of the atoms operated on by this cursor</span>
<span class="sd">        by the passed arguments (these are converted automatically</span>
<span class="sd">        to a sr.maths.Vector). Use &#39;map&#39; to specify the property</span>
<span class="sd">        map to use to find the coordinates property</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">..maths</span> <span class="kn">import</span> <span class="n">Vector</span>

        <span class="n">delta</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

        <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">move</span><span class="p">()</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">)</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Cursor.rotate"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursor.rotate">[docs]</a>    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">quaternion</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rotate all of the atoms operated on by this cursor</span>
<span class="sd">        by the passed arguments. Use &#39;map&#39; to specify the</span>
<span class="sd">        property map to use to find the coordinates property.</span>

<span class="sd">        There are many ways to specify the rotation, hence</span>
<span class="sd">        the number of named arguments:</span>

<span class="sd">        angle: (float or angle)</span>
<span class="sd">             The angle to rotate by - this is interpreted as</span>
<span class="sd">             degrees if you pass in a float. Otherwise use</span>
<span class="sd">             sire.units.degrees or sire.units.radians to specify</span>
<span class="sd">             the angle unit. This is superseded by the</span>
<span class="sd">             quaternion or matrix arguments.</span>

<span class="sd">         axis: sire.maths.Vector (or anything that can convert to a Vector)</span>
<span class="sd">             The vector about which to rotate. If this is not</span>
<span class="sd">             specified, and no other rotation specification is</span>
<span class="sd">             used, then the rotation is about the z axis.</span>
<span class="sd">             This is superseded by the quaternion or</span>
<span class="sd">             matrix arguments.</span>

<span class="sd">         center: sire.maths.Vector (or anything that can convert to a Vector)</span>
<span class="sd">             The center for the rotation. If this isn&#39;t passed then</span>
<span class="sd">             the center of mass of the atoms operated on by this</span>
<span class="sd">             cursor is used.</span>

<span class="sd">         quaternion: sire.maths.Quaternion</span>
<span class="sd">             The Quaternion description of the rotation. Note that,</span>
<span class="sd">             if you pass this, then the angle, axis and matrix</span>
<span class="sd">             arguments will be ignored.</span>

<span class="sd">         matrix: sire.maths.Matrix</span>
<span class="sd">             The 3x3 rotation matrix that describes the rotation.</span>
<span class="sd">             Note that, if you pass this, then the angle and axis</span>
<span class="sd">             arguments will be ignored. This is superseded by</span>
<span class="sd">             the quaternion argument.</span>

<span class="sd">         map: None, dict or sire.base.PropertyMap</span>
<span class="sd">             The property map used to find the coordinates property</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">..maths</span> <span class="kn">import</span> <span class="n">create_quaternion</span><span class="p">,</span> <span class="n">Vector</span>

        <span class="n">quaternion</span> <span class="o">=</span> <span class="n">create_quaternion</span><span class="p">(</span>
            <span class="n">angle</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">matrix</span><span class="o">=</span><span class="n">matrix</span><span class="p">,</span> <span class="n">quaternion</span><span class="o">=</span><span class="n">quaternion</span>
        <span class="p">)</span>

        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">center</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">center</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span><span class="o">.</span><span class="n">center_of_mass</span><span class="p">(</span><span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">center</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>

        <span class="n">view</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">move</span><span class="p">()</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">quaternion</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">)</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div></div>


<div class="viewcode-block" id="Cursors"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors">[docs]</a><span class="k">class</span> <span class="nc">Cursors</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class holds a list of Cursors. It provides some convenience</span>
<span class="sd">    functions that make working with lists of Cursor objects easier.</span>

<span class="sd">    This includes being able to commit back to the Cursor that</span>
<span class="sd">    created the list, plus being able to apply a function to</span>
<span class="sd">    each Cursor in the list</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">Cursor</span><span class="p">,</span> <span class="n">cursors</span><span class="p">:</span> <span class="n">_List</span><span class="p">[</span><span class="n">Cursor</span><span class="p">],</span> <span class="n">view</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Cursor</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2"> must be a Cursor object!&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cursors</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Cursor</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2"> must be a Cursor object!&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">parent</span><span class="o">.</span><span class="n">_d</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;The list of cursors must be created from the parent!&quot;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span> <span class="o">=</span> <span class="n">cursors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="n">view</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the sub-view(s) of this cursor that match the index &#39;i&#39;.</span>
<span class="sd">        Note that this will not look at the properties of the cursors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># do the simple thing if we are asking for the ith cursor</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># otherwise we need to search the parent and</span>
        <span class="c1"># get the cursors as needed</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">is_selector</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Either find the property that matches the passed &#39;key&#39; or</span>
<span class="sd">        look for the sub-view(s) of the cursor that match the passed key.</span>
<span class="sd">        This will only look for sub-view(s) if there are no matching</span>
<span class="sd">        properties. Use the __call__ operator to skip the property search.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">property_error</span> <span class="o">=</span> <span class="n">e</span>

        <span class="c1"># We couldn&#39;t find the property, so instead</span>
        <span class="c1"># try to find the matching sub-view</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># This interface is primarily for properties,</span>
        <span class="c1"># so raise the missing property error</span>
        <span class="k">raise</span> <span class="n">property_error</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

                <span class="k">return</span>

        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal function used to ensure that all</span>
<span class="sd">        child cursors are up to date&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Cursors::null&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">lines</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Cursors( size=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">lines</span><span class="si">}</span><span class="se">\n</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_add_bond_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal function that adds functions to this cursor</span>
<span class="sd">        that are useful when editing bonds</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">get_lengths</span><span class="p">(</span><span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Return the lengths of all bonds being edited by these</span>
<span class="sd">            cursors</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>

            <span class="n">lengths</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
                <span class="n">lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">length</span><span class="p">(</span><span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">lengths</span>

        <span class="k">def</span> <span class="nf">set_lengths</span><span class="p">(</span>
            <span class="n">values</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Set the lengths of the bonds being edited by this cursor to the</span>
<span class="sd">            specified</span>
<span class="sd">            values. Note that there should be the same number of values</span>
<span class="sd">            as there are cursors, and they should all be floats or</span>
<span class="sd">            lengths.</span>

<span class="sd">             values: list[float] or list[length]</span>
<span class="sd">                 The lengths to which to set these bonds.</span>

<span class="sd">             anchor: string or ID</span>
<span class="sd">                 The search or ID to identify atoms in the view that</span>
<span class="sd">                 are anchored, and which cannot be moved when the</span>
<span class="sd">                 internal is set.</span>

<span class="sd">             weighting: string</span>
<span class="sd">                 The weighting function used to distribute the move</span>
<span class="sd">                 across the atoms in the view. This is either;</span>
<span class="sd">                 &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                 &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                 to &#39;absolute_number&#39;</span>

<span class="sd">             auto_align: bool</span>
<span class="sd">                 Whether or not to align the molecule against itself</span>
<span class="sd">                 after the move</span>

<span class="sd">             map: sire.base.PropertyMap or dict</span>
<span class="sd">                 Map of property keys that are passed through to</span>
<span class="sd">                 control which properties are used for the move,</span>
<span class="sd">                 plus fine-grained control of the weight function</span>
<span class="sd">                 or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_length</span><span class="p">(</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                    <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                    <span class="n">auto_align</span><span class="o">=</span><span class="n">auto_align</span><span class="p">,</span>
                    <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The number of length values (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="si">}</span><span class="s2">) does &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;not equal the number of cursors (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span>
                <span class="p">)</span>

            <span class="kn">from</span> <span class="nn">..units</span> <span class="kn">import</span> <span class="n">length</span>

            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">length</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>

            <span class="n">molecule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

            <span class="nb">map</span> <span class="o">=</span> <span class="n">_process_move_options</span><span class="p">(</span>
                <span class="n">view</span><span class="o">=</span><span class="n">molecule</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="nb">map</span>
            <span class="p">)</span>
            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>

            <span class="n">moved</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">move</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                <span class="n">moved</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">auto_align</span> <span class="ow">and</span> <span class="p">(</span><span class="n">anchor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">moved</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">moved</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">def</span> <span class="nf">set_length</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Set all bonds edited by this cursor to the supplied length.</span>

<span class="sd">            value: float or length</span>
<span class="sd">                The length to which to set these bonds.</span>

<span class="sd">            anchor: string or ID</span>
<span class="sd">                The search or ID to identify atoms in the view that</span>
<span class="sd">                are anchored, and which cannot be moved when the</span>
<span class="sd">                internal is set.</span>

<span class="sd">            weighting: string</span>
<span class="sd">                The weighting function used to distribute the move</span>
<span class="sd">                across the atoms in the view. This is either;</span>
<span class="sd">                &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                to &#39;absolute_number&#39;</span>

<span class="sd">            auto_align: bool</span>
<span class="sd">                Whether or not to align the molecule against itself</span>
<span class="sd">                after the move</span>

<span class="sd">            map: sire.base.PropertyMap or dict</span>
<span class="sd">                Map of property keys that are passed through to</span>
<span class="sd">                control which properties are used for the move,</span>
<span class="sd">                plus fine-grained control of the weight function</span>
<span class="sd">                or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">))]</span>
            <span class="n">set_lengths</span><span class="p">(</span>
                <span class="n">values</span><span class="p">,</span>
                <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                <span class="n">auto_align</span><span class="o">=</span><span class="n">auto_align</span><span class="p">,</span>
                <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">def</span> <span class="nf">change_lengths</span><span class="p">(</span>
            <span class="n">deltas</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Change the bonds being edited by this cursor by the specified</span>
<span class="sd">            values. Note that there should be the same number of values</span>
<span class="sd">            as there are cursors, and they should all be floats or</span>
<span class="sd">            lengths.</span>

<span class="sd">             deltas: list[float] or list[length]</span>
<span class="sd">                 The lengths by which to change these bonds.</span>

<span class="sd">             anchor: string or ID</span>
<span class="sd">                 The search or ID to identify atoms in the view that</span>
<span class="sd">                 are anchored, and which cannot be moved when the</span>
<span class="sd">                 internal is set.</span>

<span class="sd">             weighting: string</span>
<span class="sd">                 The weighting function used to distribute the move</span>
<span class="sd">                 across the atoms in the view. This is either;</span>
<span class="sd">                 &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                 &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                 to &#39;absolute_number&#39;</span>

<span class="sd">             auto_align: bool</span>
<span class="sd">                 Whether or not to align the molecule against itself</span>
<span class="sd">                 after the move</span>

<span class="sd">             map: sire.base.PropertyMap or dict</span>
<span class="sd">                 Map of property keys that are passed through to</span>
<span class="sd">                 control which properties are used for the move,</span>
<span class="sd">                 plus fine-grained control of the weight function</span>
<span class="sd">                 or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">deltas</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_length</span><span class="p">(</span>
                    <span class="n">delta</span><span class="o">=</span><span class="n">deltas</span><span class="p">,</span>
                    <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                    <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                    <span class="n">auto_align</span><span class="o">=</span><span class="n">auto_align</span><span class="p">,</span>
                    <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">deltas</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The number of length values (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">deltas</span><span class="p">)</span><span class="si">}</span><span class="s2">) does &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;not equal the number of cursors (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span>
                <span class="p">)</span>

            <span class="kn">from</span> <span class="nn">..units</span> <span class="kn">import</span> <span class="n">length</span>

            <span class="n">deltas</span> <span class="o">=</span> <span class="p">[</span><span class="n">length</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="k">for</span> <span class="n">delta</span> <span class="ow">in</span> <span class="n">deltas</span><span class="p">]</span>

            <span class="n">molecule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

            <span class="nb">map</span> <span class="o">=</span> <span class="n">_process_move_options</span><span class="p">(</span>
                <span class="n">view</span><span class="o">=</span><span class="n">molecule</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="nb">map</span>
            <span class="p">)</span>
            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>

            <span class="n">moved</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">move</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">delta</span><span class="p">,</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">deltas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                <span class="n">moved</span><span class="o">.</span><span class="n">change</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">auto_align</span> <span class="ow">and</span> <span class="p">(</span><span class="n">anchor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">moved</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">moved</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">def</span> <span class="nf">change_length</span><span class="p">(</span>
            <span class="n">delta</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Change all bonds edited by this cursor by the supplied length.</span>

<span class="sd">            delta: float or length</span>
<span class="sd">                The length by which to change these bonds.</span>

<span class="sd">            anchor: string or ID</span>
<span class="sd">                The search or ID to identify atoms in the view that</span>
<span class="sd">                are anchored, and which cannot be moved when the</span>
<span class="sd">                internal is set.</span>

<span class="sd">            weighting: string</span>
<span class="sd">                The weighting function used to distribute the move</span>
<span class="sd">                across the atoms in the view. This is either;</span>
<span class="sd">                &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                to &#39;absolute_number&#39;</span>

<span class="sd">            auto_align: bool</span>
<span class="sd">                Whether or not to align the molecule against itself</span>
<span class="sd">                after the move</span>

<span class="sd">            map: sire.base.PropertyMap or dict</span>
<span class="sd">                Map of property keys that are passed through to</span>
<span class="sd">                control which properties are used for the move,</span>
<span class="sd">                plus fine-grained control of the weight function</span>
<span class="sd">                or anchors.&quot;&quot;&quot;</span>
            <span class="n">deltas</span> <span class="o">=</span> <span class="p">[</span><span class="n">delta</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">))]</span>
            <span class="n">change_lengths</span><span class="p">(</span>
                <span class="n">deltas</span><span class="p">,</span>
                <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                <span class="n">auto_align</span><span class="o">=</span><span class="n">auto_align</span><span class="p">,</span>
                <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lengths</span> <span class="o">=</span> <span class="n">get_lengths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_length</span> <span class="o">=</span> <span class="n">set_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_lengths</span> <span class="o">=</span> <span class="n">set_lengths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_length</span> <span class="o">=</span> <span class="n">change_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_lengths</span> <span class="o">=</span> <span class="n">change_lengths</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">measures</span> <span class="o">=</span> <span class="n">get_lengths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_measure</span> <span class="o">=</span> <span class="n">set_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_measures</span> <span class="o">=</span> <span class="n">set_lengths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_measure</span> <span class="o">=</span> <span class="n">set_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_measures</span> <span class="o">=</span> <span class="n">set_lengths</span>

    <span class="k">def</span> <span class="nf">_add_angle_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal function that adds functions to this cursor</span>
<span class="sd">        that are useful when editing angles, dihedrals or impropers</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">get_sizes</span><span class="p">(</span><span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Return the sizes of all internals being edited by these</span>
<span class="sd">            cursors</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>

            <span class="n">sizes</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
                <span class="n">sizes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">sizes</span>

        <span class="k">def</span> <span class="nf">set_sizes</span><span class="p">(</span>
            <span class="n">values</span><span class="p">,</span>
            <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">move_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Set the internals being edited by this cursor to the specified</span>
<span class="sd">            values. Note that there should be the same number of values</span>
<span class="sd">            as there are cursors, and they should all be floats or</span>
<span class="sd">            angles.</span>

<span class="sd">             values: list[float] or list[angle]</span>
<span class="sd">                 The angles to which to set these internals.</span>

<span class="sd">             anchor: string or ID</span>
<span class="sd">                 The search or ID to identify atoms in the view that</span>
<span class="sd">                 are anchored, and which cannot be moved when the</span>
<span class="sd">                 internal is set.</span>

<span class="sd">             weighting: string</span>
<span class="sd">                 The weighting function used to distribute the move</span>
<span class="sd">                 across the atoms in the view. This is either;</span>
<span class="sd">                 &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                 &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                 to &#39;absolute_number&#39;</span>

<span class="sd">             auto_align: bool</span>
<span class="sd">                 Whether or not to align the molecule against itself</span>
<span class="sd">                 after the move</span>

<span class="sd">             move_all: bool</span>
<span class="sd">                 Option only used for dihedrals. Whether or not to</span>
<span class="sd">                 move all atoms around the dihedral or just the</span>
<span class="sd">                 specified dihedral</span>

<span class="sd">             map: sire.base.PropertyMap or dict</span>
<span class="sd">                 Map of property keys that are passed through to</span>
<span class="sd">                 control which properties are used for the move,</span>
<span class="sd">                 plus fine-grained control of the weight function</span>
<span class="sd">                 or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                    <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                    <span class="n">auto_align</span><span class="o">=</span><span class="n">auto_align</span><span class="p">,</span>
                    <span class="n">move_all</span><span class="o">=</span><span class="n">move_all</span><span class="p">,</span>
                    <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The number of angle values (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="si">}</span><span class="s2">) does &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;not equal the number of cursors (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span>
                <span class="p">)</span>

            <span class="kn">from</span> <span class="nn">..units</span> <span class="kn">import</span> <span class="n">angle</span>

            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">angle</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>

            <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

            <span class="nb">map</span> <span class="o">=</span> <span class="n">_process_move_options</span><span class="p">(</span>
                <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="nb">map</span>
            <span class="p">)</span>

            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>

            <span class="n">moved</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">move</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">move_all</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_dihedral</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                    <span class="n">moved</span><span class="o">.</span><span class="n">set_all</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                    <span class="n">moved</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">auto_align</span> <span class="ow">and</span> <span class="p">(</span><span class="n">anchor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">moved</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">moved</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">def</span> <span class="nf">set_size</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span>
            <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">move_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Set all internals edited by this cursor to the supplied angle.</span>

<span class="sd">            value: float or angle</span>
<span class="sd">                The angle to which to set these internals.</span>

<span class="sd">            anchor: string or ID</span>
<span class="sd">                The search or ID to identify atoms in the view that</span>
<span class="sd">                are anchored, and which cannot be moved when the</span>
<span class="sd">                internal is set.</span>

<span class="sd">            weighting: string</span>
<span class="sd">                The weighting function used to distribute the move</span>
<span class="sd">                across the atoms in the view. This is either;</span>
<span class="sd">                &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                to &#39;absolute_number&#39;</span>

<span class="sd">            auto_align: bool</span>
<span class="sd">                Whether or not to align the molecule against itself</span>
<span class="sd">                after the move</span>

<span class="sd">            move_all: bool</span>
<span class="sd">                Option only used for dihedrals. Whether or not to</span>
<span class="sd">                move all atoms around the dihedral or just the</span>
<span class="sd">                specified dihedral</span>

<span class="sd">            map: sire.base.PropertyMap or dict</span>
<span class="sd">                Map of property keys that are passed through to</span>
<span class="sd">                control which properties are used for the move,</span>
<span class="sd">                plus fine-grained control of the weight function</span>
<span class="sd">                or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">))]</span>
            <span class="n">set_sizes</span><span class="p">(</span>
                <span class="n">values</span><span class="p">,</span>
                <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                <span class="n">auto_align</span><span class="o">=</span><span class="n">auto_align</span><span class="p">,</span>
                <span class="n">move_all</span><span class="o">=</span><span class="n">move_all</span><span class="p">,</span>
                <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">def</span> <span class="nf">change_sizes</span><span class="p">(</span>
            <span class="n">deltas</span><span class="p">,</span>
            <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">move_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Change the internals being edited by this cursor by the specified</span>
<span class="sd">            values. Note that there should be the same number of values</span>
<span class="sd">            as there are cursors, and they should all be floats or</span>
<span class="sd">            angles.</span>

<span class="sd">             deltas: list[float] or list[angle]</span>
<span class="sd">                 The angles by which to change these internals.</span>

<span class="sd">             anchor: string or ID</span>
<span class="sd">                 The search or ID to identify atoms in the view that</span>
<span class="sd">                 are anchored, and which cannot be moved when the</span>
<span class="sd">                 internal is set.</span>

<span class="sd">             weighting: string</span>
<span class="sd">                 The weighting function used to distribute the move</span>
<span class="sd">                 across the atoms in the view. This is either;</span>
<span class="sd">                 &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                 &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                 to &#39;absolute_number&#39;</span>

<span class="sd">             auto_align: bool</span>
<span class="sd">                 Whether or not to align the molecule against itself</span>
<span class="sd">                 after the move</span>

<span class="sd">             move_all: bool</span>
<span class="sd">                 Option only used for dihedrals. Whether or not to</span>
<span class="sd">                 move all atoms around the dihedral or just the</span>
<span class="sd">                 specified dihedral</span>

<span class="sd">             map: sire.base.PropertyMap or dict</span>
<span class="sd">                 Map of property keys that are passed through to</span>
<span class="sd">                 control which properties are used for the move,</span>
<span class="sd">                 plus fine-grained control of the weight function</span>
<span class="sd">                 or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">deltas</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_size</span><span class="p">(</span>
                    <span class="n">delta</span><span class="o">=</span><span class="n">deltas</span><span class="p">,</span>
                    <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                    <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                    <span class="n">auto_align</span><span class="o">=</span><span class="n">auto_align</span><span class="p">,</span>
                    <span class="n">move_all</span><span class="o">=</span><span class="n">move_all</span><span class="p">,</span>
                    <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">deltas</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The number of angle values (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">deltas</span><span class="p">)</span><span class="si">}</span><span class="s2">) does &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;not equal the number of cursors (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span>
                <span class="p">)</span>

            <span class="kn">from</span> <span class="nn">..units</span> <span class="kn">import</span> <span class="n">angle</span>

            <span class="n">deltas</span> <span class="o">=</span> <span class="p">[</span><span class="n">angle</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="k">for</span> <span class="n">delta</span> <span class="ow">in</span> <span class="n">deltas</span><span class="p">]</span>

            <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

            <span class="nb">map</span> <span class="o">=</span> <span class="n">_process_move_options</span><span class="p">(</span>
                <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="nb">map</span>
            <span class="p">)</span>

            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>

            <span class="n">moved</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">move</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">move_all</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_dihedral</span><span class="p">():</span>
                <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">BondID</span>

                <span class="k">for</span> <span class="n">delta</span><span class="p">,</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">deltas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                    <span class="n">bond</span> <span class="o">=</span> <span class="n">BondID</span><span class="p">(</span>
                        <span class="n">cursor</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">atom0</span><span class="p">(),</span> <span class="n">cursor</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">atom1</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="n">moved</span><span class="o">.</span><span class="n">change</span><span class="p">(</span><span class="n">bond</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">delta</span><span class="p">,</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">deltas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                    <span class="n">moved</span><span class="o">.</span><span class="n">change</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">auto_align</span> <span class="ow">and</span> <span class="p">(</span><span class="n">anchor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">moved</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">moved</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">def</span> <span class="nf">change_size</span><span class="p">(</span>
            <span class="n">delta</span><span class="p">,</span>
            <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">move_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Change all internals edited by this cursor by the supplied angle.</span>

<span class="sd">            delta: float or angle</span>
<span class="sd">                The angle by which to change these internals.</span>

<span class="sd">            anchor: string or ID</span>
<span class="sd">                The search or ID to identify atoms in the view that</span>
<span class="sd">                are anchored, and which cannot be moved when the</span>
<span class="sd">                internal is set.</span>

<span class="sd">            weighting: string</span>
<span class="sd">                The weighting function used to distribute the move</span>
<span class="sd">                across the atoms in the view. This is either;</span>
<span class="sd">                &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                to &#39;absolute_number&#39;</span>

<span class="sd">            auto_align: bool</span>
<span class="sd">                Whether or not to align the molecule against itself</span>
<span class="sd">                after the move</span>

<span class="sd">            move_all: bool</span>
<span class="sd">                Option only used for dihedrals. Whether or not to</span>
<span class="sd">                move all atoms around the dihedral or just the</span>
<span class="sd">                specified dihedral</span>

<span class="sd">            map: sire.base.PropertyMap or dict</span>
<span class="sd">                Map of property keys that are passed through to</span>
<span class="sd">                control which properties are used for the move,</span>
<span class="sd">                plus fine-grained control of the weight function</span>
<span class="sd">                or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">deltas</span> <span class="o">=</span> <span class="p">[</span><span class="n">delta</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">))]</span>
            <span class="n">change_sizes</span><span class="p">(</span>
                <span class="n">deltas</span><span class="p">,</span>
                <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                <span class="n">auto_align</span><span class="o">=</span><span class="n">auto_align</span><span class="p">,</span>
                <span class="n">move_all</span><span class="o">=</span><span class="n">move_all</span><span class="p">,</span>
                <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sizes</span> <span class="o">=</span> <span class="n">get_sizes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_size</span> <span class="o">=</span> <span class="n">set_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_sizes</span> <span class="o">=</span> <span class="n">set_sizes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_size</span> <span class="o">=</span> <span class="n">change_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_sizes</span> <span class="o">=</span> <span class="n">change_sizes</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">measures</span> <span class="o">=</span> <span class="n">get_sizes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_measure</span> <span class="o">=</span> <span class="n">set_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_measures</span> <span class="o">=</span> <span class="n">set_sizes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_measure</span> <span class="o">=</span> <span class="n">set_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_measures</span> <span class="o">=</span> <span class="n">set_sizes</span>

    <span class="k">def</span> <span class="nf">_add_extra_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal function used to add extra member functions to this</span>
<span class="sd">        cursor depending on the type of object being edited</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;set_length&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_bond_functions</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;set_size&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_angle_functions</span><span class="p">()</span>

<div class="viewcode-block" id="Cursors.is_same_editor"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.is_same_editor">[docs]</a>    <span class="k">def</span> <span class="nf">is_same_editor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether this is using the same editor to edit</span>
<span class="sd">        the molecule as &#39;other&#39;. This returns true if the underlying</span>
<span class="sd">        editor for both cursors is the same, i.e. changes made by</span>
<span class="sd">        one cursor would be seen and be editable by the other cursor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">is_same_editor</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cursors.get"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the property associated with key &#39;key&#39;&quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">values</span></div>

<div class="viewcode-block" id="Cursors.set"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the property associated with key &#39;key&#39; to the</span>
<span class="sd">        passed value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Cursors.delete"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the property associated with the key &#39;key&#39;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Cursors.view"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.view">[docs]</a>    <span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the view underpinning this cursor. This is</span>
<span class="sd">        the same as calling &#39;.commit()&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>

        <span class="kn">from</span> <span class="nn">..legacy.Mol</span> <span class="kn">import</span> <span class="n">Molecules</span>

        <span class="n">ret</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Molecules</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="Cursors.commit"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.commit">[docs]</a>    <span class="k">def</span> <span class="nf">commit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Commit all of the changes and return the newly</span>
<span class="sd">        edited molecule (or MoleculeView). This commits</span>
<span class="sd">        on the parent Cursor that was used to create</span>
<span class="sd">        this list, e.g.</span>

<span class="sd">        &gt;&gt;&gt; mol.cursor().atoms().commit()</span>

<span class="sd">        will commit and return the updated molecule (mol).</span>

<span class="sd">        This is equivalent to `self.parent().commit()`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cursors.atoms"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.atoms">[docs]</a>    <span class="k">def</span> <span class="nf">atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of atoms in this view,</span>
<span class="sd">        of, if &#39;id&#39; is supplied, the atoms in this view</span>
<span class="sd">        that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">atoms</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">atoms</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="Cursors.residues"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.residues">[docs]</a>    <span class="k">def</span> <span class="nf">residues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of residues in this view,</span>
<span class="sd">        of, if &#39;id&#39; is supplied, the residues in this view</span>
<span class="sd">        that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">residues</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">residues</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="Cursors.chains"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.chains">[docs]</a>    <span class="k">def</span> <span class="nf">chains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of chains in this view,</span>
<span class="sd">        of, if &#39;id&#39; is supplied, the chains in this view</span>
<span class="sd">        that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">chains</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">chains</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="Cursors.segments"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.segments">[docs]</a>    <span class="k">def</span> <span class="nf">segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of segments in this view,</span>
<span class="sd">        of, if &#39;id&#39; is supplied, the segments in this view</span>
<span class="sd">        that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">segments</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">segments</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="Cursors.bonds"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.bonds">[docs]</a>    <span class="k">def</span> <span class="nf">bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of the bonds in this</span>
<span class="sd">        view or, if &#39;id&#39; is supplied, the bonds in this</span>
<span class="sd">        view that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">bonds</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="Cursors.angles"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.angles">[docs]</a>    <span class="k">def</span> <span class="nf">angles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of the angles in this</span>
<span class="sd">        view or, if &#39;id&#39; is supplied, the angles in this</span>
<span class="sd">        view that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">angles</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="Cursors.dihedrals"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.dihedrals">[docs]</a>    <span class="k">def</span> <span class="nf">dihedrals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of the dihedrals in this</span>
<span class="sd">        view or, if &#39;id&#39; is supplied, the dihedrals in this</span>
<span class="sd">        view that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">dihedrals</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="Cursors.impropers"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.impropers">[docs]</a>    <span class="k">def</span> <span class="nf">impropers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of the impropers in this</span>
<span class="sd">        view or, if &#39;id&#39; is supplied, the impropers in this</span>
<span class="sd">        view that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">impropers</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="Cursors.atom"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.atom">[docs]</a>    <span class="k">def</span> <span class="nf">atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the atom in the molecule that matches the passed ID&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">atom</span><span class="p">(</span><span class="n">i</span><span class="p">))</span></div>

<div class="viewcode-block" id="Cursors.residue"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.residue">[docs]</a>    <span class="k">def</span> <span class="nf">residue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the residue in the molecule that matches the passed ID.</span>
<span class="sd">        If &#39;i&#39; is None, then this returns the residue that contains</span>
<span class="sd">        this atom (if this is an atom)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">residue</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">residue</span><span class="p">(</span><span class="n">i</span><span class="p">))</span></div>

<div class="viewcode-block" id="Cursors.chain"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.chain">[docs]</a>    <span class="k">def</span> <span class="nf">chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the chain in the molecule that matches the passed ID.</span>
<span class="sd">        If &#39;i&#39; is None, then this returns the chain that contains</span>
<span class="sd">        this atom (if this is an atom)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">chain</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">i</span><span class="p">))</span></div>

<div class="viewcode-block" id="Cursors.segment"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.segment">[docs]</a>    <span class="k">def</span> <span class="nf">segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the segment in the molecule that matches the passed ID.</span>
<span class="sd">        If &#39;i&#39; is None, then this returns the segment that contains</span>
<span class="sd">        this atom (if this is an atom)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">segment</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">i</span><span class="p">))</span></div>

<div class="viewcode-block" id="Cursors.molecule"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.molecule">[docs]</a>    <span class="k">def</span> <span class="nf">molecule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the molecule&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cursors.bond"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.bond">[docs]</a>    <span class="k">def</span> <span class="nf">bond</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the Cursor for the specified bond.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">bond</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="Cursors.angle"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.angle">[docs]</a>    <span class="k">def</span> <span class="nf">angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the Cursor for the specified angle.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="Cursors.dihedral"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.dihedral">[docs]</a>    <span class="k">def</span> <span class="nf">dihedral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the Cursor for the specified dihedral.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">dihedral</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="Cursors.improper"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.improper">[docs]</a>    <span class="k">def</span> <span class="nf">improper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the Cursor for the specified improper.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">improper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="Cursors.invert"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.invert">[docs]</a>    <span class="k">def</span> <span class="nf">invert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the inverse view of this cursor (i.e. all views that</span>
<span class="sd">        are not selected - same as view.invert())&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="o">.</span><span class="n">invert</span><span class="p">())</span></div>

<div class="viewcode-block" id="Cursors.parent"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.parent">[docs]</a>    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the parent cursor&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span></div>

<div class="viewcode-block" id="Cursors.apply"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the passed function (with optional position and keyword</span>
<span class="sd">        arguments) to all of the cursors in this list of Cursors</span>
<span class="sd">        (i.e. everything except the parent). As the function is intended to use</span>
<span class="sd">        the Cursor to edit molecules, only this Cursors object will be</span>
<span class="sd">        returned.</span>

<span class="sd">        This lets you run `.apply(...).commit()` as a single line.</span>

<span class="sd">        The function can be either;</span>

<span class="sd">        1. a string containing the name of the function to call, or</span>
<span class="sd">        2. an actual function (either a normal function or a lambda expression)</span>

<span class="sd">        You can optionally pass in positional and keyword arguments</span>
<span class="sd">        here that will be passed to the function.</span>

<span class="sd">        Args:</span>
<span class="sd">            func (str or function): The function to be called, or the name</span>
<span class="sd">                                    of the function to be called.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Cursors: This list of cursors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Cursors.num_frames"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.num_frames">[docs]</a>    <span class="k">def</span> <span class="nf">num_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the number of frames in the trajectory held by this molecule</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">num_frames</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cursors.load_frame"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.load_frame">[docs]</a>    <span class="k">def</span> <span class="nf">load_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call `load_frame` with these arguments on all contained cursors&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">load_frame</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Cursors.save_frame"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.save_frame">[docs]</a>    <span class="k">def</span> <span class="nf">save_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call &#39;save_frame&#39; with these arguments on all contained cursors&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">save_frame</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Cursors.delete_frame"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.delete_frame">[docs]</a>    <span class="k">def</span> <span class="nf">delete_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call &#39;delete_frame&#39; with these arguments on all contained cursors&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">delete_frame</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Cursors.translate"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Translate all of the atoms operated on by these cursors</span>
<span class="sd">        by the passed arguments (these are converted automatically</span>
<span class="sd">        to a sr.maths.Vector). Use &#39;map&#39; to specify the property</span>
<span class="sd">        map to use to find the coordinates property</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Cursors.rotate"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.Cursors.rotate">[docs]</a>    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">quaternion</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rotate all of the atoms operated on by this cursor</span>
<span class="sd">        by the passed arguments. Use &#39;map&#39; to specify the</span>
<span class="sd">        property map to use to find the coordinates property.</span>

<span class="sd">        There are many ways to specify the rotation, hence</span>
<span class="sd">        the number of named arguments:</span>

<span class="sd">        angle: (float or angle)</span>
<span class="sd">             The angle to rotate by - this is interpreted as</span>
<span class="sd">             degrees if you pass in a float. Otherwise use</span>
<span class="sd">             sire.units.degrees or sire.units.radians to specify</span>
<span class="sd">             the angle unit. This is superseded by the</span>
<span class="sd">             quaternion or matrix arguments.</span>

<span class="sd">         axis: sire.maths.Vector (or anything that can convert to a Vector)</span>
<span class="sd">             The vector about which to rotate. If this is not</span>
<span class="sd">             specified, and no other rotation specification is</span>
<span class="sd">             used, then the rotation is about the z axis.</span>
<span class="sd">             This is superseded by the quaternion or</span>
<span class="sd">             matrix arguments.</span>

<span class="sd">         center: sire.maths.Vector (or anything that can convert to a Vector)</span>
<span class="sd">             The center for the rotation. If this isn&#39;t passed then</span>
<span class="sd">             the center of mass of the atoms operated on by this</span>
<span class="sd">             cursor is used.</span>

<span class="sd">         quaternion: sire.maths.Quaternion</span>
<span class="sd">             The Quaternion description of the rotation. Note that,</span>
<span class="sd">             if you pass this, then the angle, axis and matrix</span>
<span class="sd">             arguments will be ignored.</span>

<span class="sd">         matrix: sire.maths.Matrix</span>
<span class="sd">             The 3x3 rotation matrix that describes the rotation.</span>
<span class="sd">             Note that, if you pass this, then the angle and axis</span>
<span class="sd">             arguments will be ignored. This is superseded by</span>
<span class="sd">             the quaternion argument.</span>

<span class="sd">         map: None, dict or sire.base.PropertyMap</span>
<span class="sd">             The property map used to find the coordinates property</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">..maths</span> <span class="kn">import</span> <span class="n">create_quaternion</span>

        <span class="n">quaternion</span> <span class="o">=</span> <span class="n">create_quaternion</span><span class="p">(</span>
            <span class="n">angle</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">matrix</span><span class="o">=</span><span class="n">matrix</span><span class="p">,</span> <span class="n">quaternion</span><span class="o">=</span><span class="n">quaternion</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">quaternion</span><span class="o">=</span><span class="n">quaternion</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div></div>


<div class="viewcode-block" id="CursorsM"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM">[docs]</a><span class="k">class</span> <span class="nc">CursorsM</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class holds a list of Cursor/Cursors that operate across</span>
<span class="sd">    multiple molecules. This allows you to perform editing</span>
<span class="sd">    operations across many molecules at the same time.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">parent</span><span class="p">:</span>
                <span class="n">child_mol</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span>
                <span class="n">molnum</span> <span class="o">=</span> <span class="n">child_mol</span><span class="o">.</span><span class="n">number</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">molnum</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span> <span class="o">=</span> <span class="n">child_mol</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_add_bond_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal function used to add functions for editing bonds&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">get_lengths</span><span class="p">(</span><span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Return the lengths of all the bonds edited by this cursor.&quot;&quot;&quot;</span>
            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>

            <span class="n">lengths</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
                <span class="n">lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">length</span><span class="p">(</span><span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">lengths</span>

        <span class="k">def</span> <span class="nf">set_lengths</span><span class="p">(</span>
            <span class="n">values</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Set the lengths of the bonds being edited by this cursor to the</span>
<span class="sd">            specified values. Note that there should be the same number of</span>
<span class="sd">            values as there are cursors, and they should all be floats or</span>
<span class="sd">            lengths.</span>

<span class="sd">             values: list[float] or list[length]</span>
<span class="sd">                 The lengths to which to set these bonds.</span>

<span class="sd">             anchor: string or ID</span>
<span class="sd">                 The search or ID to identify atoms in the view that</span>
<span class="sd">                 are anchored, and which cannot be moved when the</span>
<span class="sd">                 internal is set.</span>

<span class="sd">             weighting: string</span>
<span class="sd">                 The weighting function used to distribute the move</span>
<span class="sd">                 across the atoms in the view. This is either;</span>
<span class="sd">                 &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                 &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                 to &#39;absolute_number&#39;</span>

<span class="sd">             auto_align: bool</span>
<span class="sd">                 Whether or not to align the molecule against itself</span>
<span class="sd">                 after the move</span>

<span class="sd">             map: sire.base.PropertyMap or dict</span>
<span class="sd">                 Map of property keys that are passed through to</span>
<span class="sd">                 control which properties are used for the move,</span>
<span class="sd">                 plus fine-grained control of the weight function</span>
<span class="sd">                 or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_length</span><span class="p">(</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                    <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                    <span class="n">auto_align</span><span class="o">=</span><span class="n">auto_align</span><span class="p">,</span>
                    <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The number of length values (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="si">}</span><span class="s2">) does &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;not equal the number of cursors (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span>
                <span class="p">)</span>

            <span class="kn">from</span> <span class="nn">..units</span> <span class="kn">import</span> <span class="n">length</span>

            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">length</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>

            <span class="n">movers</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">molecules</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">maps</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                <span class="n">molnum</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">number</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">molnum</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">movers</span><span class="p">:</span>
                    <span class="n">molecule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                    <span class="n">molecules</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span> <span class="o">=</span> <span class="n">molecule</span>
                    <span class="n">movers</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">move</span><span class="p">()</span>
                    <span class="n">maps</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                        <span class="n">_process_move_options</span><span class="p">(</span>
                            <span class="n">view</span><span class="o">=</span><span class="n">molecule</span><span class="p">,</span>
                            <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                            <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                            <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                <span class="n">movers</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">maps</span><span class="p">[</span><span class="n">molnum</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">molnum</span><span class="p">,</span> <span class="n">mover</span> <span class="ow">in</span> <span class="n">movers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">auto_align</span> <span class="ow">and</span> <span class="p">(</span><span class="n">anchor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">mover</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">molecules</span><span class="p">[</span><span class="n">molnum</span><span class="p">],</span> <span class="n">maps</span><span class="p">[</span><span class="n">molnum</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">mover</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">def</span> <span class="nf">set_length</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Set the lengths of all of the bonds edited by this</span>
<span class="sd">            cursor to the passed value.</span>

<span class="sd">             value: float or length</span>
<span class="sd">                 The length to which to set these bonds.</span>

<span class="sd">             anchor: string or ID</span>
<span class="sd">                 The search or ID to identify atoms in the view that</span>
<span class="sd">                 are anchored, and which cannot be moved when the</span>
<span class="sd">                 internal is set.</span>

<span class="sd">             weighting: string</span>
<span class="sd">                 The weighting function used to distribute the move</span>
<span class="sd">                 across the atoms in the view. This is either;</span>
<span class="sd">                 &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                 &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                 to &#39;absolute_number&#39;</span>

<span class="sd">             auto_align: bool</span>
<span class="sd">                 Whether or not to align the molecule against itself</span>
<span class="sd">                 after the move</span>

<span class="sd">             map: sire.base.PropertyMap or dict</span>
<span class="sd">                 Map of property keys that are passed through to</span>
<span class="sd">                 control which properties are used for the move,</span>
<span class="sd">                 plus fine-grained control of the weight function</span>
<span class="sd">                 or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">]</span>
            <span class="n">set_lengths</span><span class="p">(</span>
                <span class="n">values</span><span class="p">,</span>
                <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                <span class="n">auto_align</span><span class="o">=</span><span class="n">auto_align</span><span class="p">,</span>
                <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">def</span> <span class="nf">change_lengths</span><span class="p">(</span>
            <span class="n">deltas</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Change the lengths of the bonds being edited by this cursor by</span>
<span class="sd">            the specified deltas. Note that there should be the same number of</span>
<span class="sd">            values as there are cursors, and they should all be floats or</span>
<span class="sd">            lengths.</span>

<span class="sd">             deltas: list[float] or list[length]</span>
<span class="sd">                 The lengths by which to change these bonds.</span>

<span class="sd">             anchor: string or ID</span>
<span class="sd">                 The search or ID to identify atoms in the view that</span>
<span class="sd">                 are anchored, and which cannot be moved when the</span>
<span class="sd">                 internal is set.</span>

<span class="sd">             weighting: string</span>
<span class="sd">                 The weighting function used to distribute the move</span>
<span class="sd">                 across the atoms in the view. This is either;</span>
<span class="sd">                 &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                 &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                 to &#39;absolute_number&#39;</span>

<span class="sd">             auto_align: bool</span>
<span class="sd">                 Whether or not to align the molecule against itself</span>
<span class="sd">                 after the move</span>

<span class="sd">             map: sire.base.PropertyMap or dict</span>
<span class="sd">                 Map of property keys that are passed through to</span>
<span class="sd">                 control which properties are used for the move,</span>
<span class="sd">                 plus fine-grained control of the weight function</span>
<span class="sd">                 or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">deltas</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_length</span><span class="p">(</span>
                    <span class="n">delta</span><span class="o">=</span><span class="n">deltas</span><span class="p">,</span>
                    <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                    <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                    <span class="n">auto_align</span><span class="o">=</span><span class="n">auto_align</span><span class="p">,</span>
                    <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">deltas</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The number of length values (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">deltas</span><span class="p">)</span><span class="si">}</span><span class="s2">) does &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;not equal the number of cursors (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span>
                <span class="p">)</span>

            <span class="kn">from</span> <span class="nn">..units</span> <span class="kn">import</span> <span class="n">length</span>

            <span class="n">deltas</span> <span class="o">=</span> <span class="p">[</span><span class="n">length</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="k">for</span> <span class="n">delta</span> <span class="ow">in</span> <span class="n">deltas</span><span class="p">]</span>

            <span class="n">movers</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">molecules</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">maps</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">delta</span><span class="p">,</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">deltas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                <span class="n">molnum</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">number</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">molnum</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">movers</span><span class="p">:</span>
                    <span class="n">molecule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                    <span class="n">molecules</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span> <span class="o">=</span> <span class="n">molecule</span>
                    <span class="n">movers</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">move</span><span class="p">()</span>
                    <span class="n">maps</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                        <span class="n">_process_move_options</span><span class="p">(</span>
                            <span class="n">view</span><span class="o">=</span><span class="n">molecule</span><span class="p">,</span>
                            <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                            <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                            <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                <span class="n">movers</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span><span class="o">.</span><span class="n">change</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">maps</span><span class="p">[</span><span class="n">molnum</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">molnum</span><span class="p">,</span> <span class="n">mover</span> <span class="ow">in</span> <span class="n">movers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">auto_align</span> <span class="ow">and</span> <span class="p">(</span><span class="n">anchor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">mover</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">molecules</span><span class="p">[</span><span class="n">molnum</span><span class="p">],</span> <span class="n">maps</span><span class="p">[</span><span class="n">molnum</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">mover</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">def</span> <span class="nf">change_length</span><span class="p">(</span>
            <span class="n">delta</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Change the lengths of all of the bonds edited by this</span>
<span class="sd">            cursor by the passed value.</span>

<span class="sd">             delta: float or length</span>
<span class="sd">                 The length by which to change these bonds.</span>

<span class="sd">             anchor: string or ID</span>
<span class="sd">                 The search or ID to identify atoms in the view that</span>
<span class="sd">                 are anchored, and which cannot be moved when the</span>
<span class="sd">                 internal is set.</span>

<span class="sd">             weighting: string</span>
<span class="sd">                 The weighting function used to distribute the move</span>
<span class="sd">                 across the atoms in the view. This is either;</span>
<span class="sd">                 &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                 &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                 to &#39;absolute_number&#39;</span>

<span class="sd">             auto_align: bool</span>
<span class="sd">                 Whether or not to align the molecule against itself</span>
<span class="sd">                 after the move</span>

<span class="sd">             map: sire.base.PropertyMap or dict</span>
<span class="sd">                 Map of property keys that are passed through to</span>
<span class="sd">                 control which properties are used for the move,</span>
<span class="sd">                 plus fine-grained control of the weight function</span>
<span class="sd">                 or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">deltas</span> <span class="o">=</span> <span class="p">[</span><span class="n">delta</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">]</span>
            <span class="n">change_lengths</span><span class="p">(</span>
                <span class="n">deltas</span><span class="p">,</span>
                <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                <span class="n">auto_align</span><span class="o">=</span><span class="n">auto_align</span><span class="p">,</span>
                <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lengths</span> <span class="o">=</span> <span class="n">get_lengths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_length</span> <span class="o">=</span> <span class="n">set_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_lengths</span> <span class="o">=</span> <span class="n">set_lengths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_length</span> <span class="o">=</span> <span class="n">change_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_lengths</span> <span class="o">=</span> <span class="n">change_lengths</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">measures</span> <span class="o">=</span> <span class="n">get_lengths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_measure</span> <span class="o">=</span> <span class="n">set_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_measures</span> <span class="o">=</span> <span class="n">set_lengths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_measure</span> <span class="o">=</span> <span class="n">change_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_measures</span> <span class="o">=</span> <span class="n">change_lengths</span>

    <span class="k">def</span> <span class="nf">_add_angle_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal function used to add functions for editing</span>
<span class="sd">        angles, dihedrals or impropers</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">get_sizes</span><span class="p">(</span><span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Return the sizes of all the internals edited by this cursor.&quot;&quot;&quot;</span>
            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>

            <span class="n">sizes</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
                <span class="n">sizes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">sizes</span>

        <span class="k">def</span> <span class="nf">set_sizes</span><span class="p">(</span>
            <span class="n">values</span><span class="p">,</span>
            <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">move_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Set the sizes of the internals being edited by this cursor to the</span>
<span class="sd">            specified values. Note that there should be the same number of</span>
<span class="sd">            values as there are cursors, and they should all be floats or</span>
<span class="sd">            angles.</span>

<span class="sd">             values: list[float] or list[angle]</span>
<span class="sd">                 The angles to which to set these internals.</span>

<span class="sd">             anchor: string or ID</span>
<span class="sd">                 The search or ID to identify atoms in the view that</span>
<span class="sd">                 are anchored, and which cannot be moved when the</span>
<span class="sd">                 internal is set.</span>

<span class="sd">             weighting: string</span>
<span class="sd">                 The weighting function used to distribute the move</span>
<span class="sd">                 across the atoms in the view. This is either;</span>
<span class="sd">                 &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                 &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                 to &#39;absolute_number&#39;</span>

<span class="sd">             auto_align: bool</span>
<span class="sd">                 Whether or not to align the molecule against itself</span>
<span class="sd">                 after the move</span>

<span class="sd">             move_all: bool</span>
<span class="sd">                 Option only used for dihedrals. Whether or not to</span>
<span class="sd">                 move all atoms around the dihedral or just the</span>
<span class="sd">                 specified dihedral</span>

<span class="sd">             map: sire.base.PropertyMap or dict</span>
<span class="sd">                 Map of property keys that are passed through to</span>
<span class="sd">                 control which properties are used for the move,</span>
<span class="sd">                 plus fine-grained control of the weight function</span>
<span class="sd">                 or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                    <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                    <span class="n">auto_align</span><span class="o">=</span><span class="n">auto_align</span><span class="p">,</span>
                    <span class="n">move_all</span><span class="o">=</span><span class="n">move_all</span><span class="p">,</span>
                    <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The number of angle values (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="si">}</span><span class="s2">) does &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;not equal the number of cursors (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span>
                <span class="p">)</span>

            <span class="kn">from</span> <span class="nn">..units</span> <span class="kn">import</span> <span class="n">angle</span>

            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">angle</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>

            <span class="n">molecules</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">movers</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">maps</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                <span class="n">molnum</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">number</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">molnum</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">movers</span><span class="p">:</span>
                    <span class="n">molecule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                    <span class="n">molecules</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span> <span class="o">=</span> <span class="n">molecule</span>
                    <span class="n">movers</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">move</span><span class="p">()</span>
                    <span class="n">maps</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                        <span class="n">_process_move_options</span><span class="p">(</span>
                            <span class="n">view</span><span class="o">=</span><span class="n">molecule</span><span class="p">,</span>
                            <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                            <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                            <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                <span class="n">movers</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">maps</span><span class="p">[</span><span class="n">molnum</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">molnum</span><span class="p">,</span> <span class="n">mover</span> <span class="ow">in</span> <span class="n">movers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">auto_align</span> <span class="ow">and</span> <span class="p">(</span><span class="n">anchor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">mover</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">molecules</span><span class="p">[</span><span class="n">molnum</span><span class="p">],</span> <span class="nb">map</span><span class="p">[</span><span class="n">molnum</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">mover</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">def</span> <span class="nf">set_size</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span>
            <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">move_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Set the sizes of all of the internals edited by this</span>
<span class="sd">            cursor to the passed value.</span>

<span class="sd">             value: float or angle</span>
<span class="sd">                 The angle to which to set these internals.</span>

<span class="sd">             anchor: string or ID</span>
<span class="sd">                 The search or ID to identify atoms in the view that</span>
<span class="sd">                 are anchored, and which cannot be moved when the</span>
<span class="sd">                 internal is set.</span>

<span class="sd">             weighting: string</span>
<span class="sd">                 The weighting function used to distribute the move</span>
<span class="sd">                 across the atoms in the view. This is either;</span>
<span class="sd">                 &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                 &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                 to &#39;absolute_number&#39;</span>

<span class="sd">             auto_align: bool</span>
<span class="sd">                 Whether or not to align the molecule against itself</span>
<span class="sd">                 after the move</span>

<span class="sd">             move_all: bool</span>
<span class="sd">                 Option only used for dihedrals. Whether or not to</span>
<span class="sd">                 move all atoms around the dihedral or just the</span>
<span class="sd">                 specified dihedral</span>

<span class="sd">             map: sire.base.PropertyMap or dict</span>
<span class="sd">                 Map of property keys that are passed through to</span>
<span class="sd">                 control which properties are used for the move,</span>
<span class="sd">                 plus fine-grained control of the weight function</span>
<span class="sd">                 or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">]</span>
            <span class="n">set_sizes</span><span class="p">(</span>
                <span class="n">values</span><span class="p">,</span>
                <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                <span class="n">auto_align</span><span class="o">=</span><span class="n">auto_align</span><span class="p">,</span>
                <span class="n">move_all</span><span class="o">=</span><span class="n">move_all</span><span class="p">,</span>
                <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">def</span> <span class="nf">change_sizes</span><span class="p">(</span>
            <span class="n">deltas</span><span class="p">,</span>
            <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">move_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Change the sizes of the internals being edited by this cursor by</span>
<span class="sd">            the specified values. Note that there should be the same number of</span>
<span class="sd">            values as there are cursors, and they should all be floats or</span>
<span class="sd">            angles.</span>

<span class="sd">             deltas: list[float] or list[angle]</span>
<span class="sd">                 The angles by which to change these internals.</span>

<span class="sd">             anchor: string or ID</span>
<span class="sd">                 The search or ID to identify atoms in the view that</span>
<span class="sd">                 are anchored, and which cannot be moved when the</span>
<span class="sd">                 internal is set.</span>

<span class="sd">             weighting: string</span>
<span class="sd">                 The weighting function used to distribute the move</span>
<span class="sd">                 across the atoms in the view. This is either;</span>
<span class="sd">                 &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                 &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                 to &#39;absolute_number&#39;</span>

<span class="sd">             auto_align: bool</span>
<span class="sd">                 Whether or not to align the molecule against itself</span>
<span class="sd">                 after the move</span>

<span class="sd">             move_all: bool</span>
<span class="sd">                 Option only used for dihedrals. Whether or not to</span>
<span class="sd">                 move all atoms around the dihedral or just the</span>
<span class="sd">                 specified dihedral</span>

<span class="sd">             map: sire.base.PropertyMap or dict</span>
<span class="sd">                 Map of property keys that are passed through to</span>
<span class="sd">                 control which properties are used for the move,</span>
<span class="sd">                 plus fine-grained control of the weight function</span>
<span class="sd">                 or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">deltas</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_size</span><span class="p">(</span>
                    <span class="n">delta</span><span class="o">=</span><span class="n">deltas</span><span class="p">,</span>
                    <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                    <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                    <span class="n">auto_align</span><span class="o">=</span><span class="n">auto_align</span><span class="p">,</span>
                    <span class="n">move_all</span><span class="o">=</span><span class="n">move_all</span><span class="p">,</span>
                    <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">deltas</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The number of angle values (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">deltas</span><span class="p">)</span><span class="si">}</span><span class="s2">) does &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;not equal the number of cursors (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span>
                <span class="p">)</span>

            <span class="kn">from</span> <span class="nn">..units</span> <span class="kn">import</span> <span class="n">angle</span>

            <span class="n">deltas</span> <span class="o">=</span> <span class="p">[</span><span class="n">angle</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="k">for</span> <span class="n">delta</span> <span class="ow">in</span> <span class="n">deltas</span><span class="p">]</span>

            <span class="n">molecules</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">movers</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">maps</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">if</span> <span class="n">move_all</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_dihedral</span><span class="p">():</span>
                <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">BondID</span>

                <span class="k">for</span> <span class="n">delta</span><span class="p">,</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">deltas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                    <span class="n">molnum</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">number</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">molnum</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">movers</span><span class="p">:</span>
                        <span class="n">molecule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="p">[</span>
                            <span class="n">molnum</span>
                        <span class="p">]</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                        <span class="n">molecules</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span> <span class="o">=</span> <span class="n">molecule</span>
                        <span class="n">movers</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">move</span><span class="p">()</span>
                        <span class="n">maps</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                            <span class="n">_process_move_options</span><span class="p">(</span>
                                <span class="n">view</span><span class="o">=</span><span class="n">molecule</span><span class="p">,</span>
                                <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                                <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                                <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

                    <span class="n">bond</span> <span class="o">=</span> <span class="n">BondID</span><span class="p">(</span>
                        <span class="n">cursor</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">atom0</span><span class="p">(),</span> <span class="n">cursor</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">atom1</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="n">movers</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span><span class="o">.</span><span class="n">change</span><span class="p">(</span><span class="n">bond</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">maps</span><span class="p">[</span><span class="n">molnum</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">delta</span><span class="p">,</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">deltas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                    <span class="n">molnum</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">number</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">molnum</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">movers</span><span class="p">:</span>
                        <span class="n">molecule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="p">[</span>
                            <span class="n">molnum</span>
                        <span class="p">]</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                        <span class="n">molecules</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span> <span class="o">=</span> <span class="n">molecule</span>
                        <span class="n">movers</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">move</span><span class="p">()</span>
                        <span class="n">maps</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                            <span class="n">_process_move_options</span><span class="p">(</span>
                                <span class="n">view</span><span class="o">=</span><span class="n">molecule</span><span class="p">,</span>
                                <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                                <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                                <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

                    <span class="n">movers</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span><span class="o">.</span><span class="n">change</span><span class="p">(</span>
                        <span class="n">cursor</span><span class="o">.</span><span class="n">_internal</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">maps</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span>
                    <span class="p">)</span>

            <span class="k">for</span> <span class="n">molnum</span><span class="p">,</span> <span class="n">mover</span> <span class="ow">in</span> <span class="n">movers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">auto_align</span> <span class="ow">and</span> <span class="p">(</span><span class="n">anchor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">mover</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">molecules</span><span class="p">[</span><span class="n">molnum</span><span class="p">],</span> <span class="n">maps</span><span class="p">[</span><span class="n">molnum</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">mover</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">def</span> <span class="nf">change_size</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span>
            <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">move_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Change the sizes of all of the internals edited by this</span>
<span class="sd">            cursor by the passed value.</span>

<span class="sd">             delta: float or angle</span>
<span class="sd">                 The angle by which to change these internals.</span>

<span class="sd">             anchor: string or ID</span>
<span class="sd">                 The search or ID to identify atoms in the view that</span>
<span class="sd">                 are anchored, and which cannot be moved when the</span>
<span class="sd">                 internal is set.</span>

<span class="sd">             weighting: string</span>
<span class="sd">                 The weighting function used to distribute the move</span>
<span class="sd">                 across the atoms in the view. This is either;</span>
<span class="sd">                 &#39;absolute_number&#39;, &#39;relative_number&#39;,</span>
<span class="sd">                 &#39;absolute_mass&#39; or &#39;relative_mass&#39;. It defaults</span>
<span class="sd">                 to &#39;absolute_number&#39;</span>

<span class="sd">             auto_align: bool</span>
<span class="sd">                 Whether or not to align the molecule against itself</span>
<span class="sd">                 after the move</span>

<span class="sd">             move_all: bool</span>
<span class="sd">                 Option only used for dihedrals. Whether or not to</span>
<span class="sd">                 move all atoms around the dihedral or just the</span>
<span class="sd">                 specified dihedral</span>

<span class="sd">             map: sire.base.PropertyMap or dict</span>
<span class="sd">                 Map of property keys that are passed through to</span>
<span class="sd">                 control which properties are used for the move,</span>
<span class="sd">                 plus fine-grained control of the weight function</span>
<span class="sd">                 or anchors.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">]</span>
            <span class="n">change_sizes</span><span class="p">(</span>
                <span class="n">values</span><span class="p">,</span>
                <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
                <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
                <span class="n">auto_align</span><span class="o">=</span><span class="n">auto_align</span><span class="p">,</span>
                <span class="n">move_all</span><span class="o">=</span><span class="n">move_all</span><span class="p">,</span>
                <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sizes</span> <span class="o">=</span> <span class="n">get_sizes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_size</span> <span class="o">=</span> <span class="n">set_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_sizes</span> <span class="o">=</span> <span class="n">set_sizes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_size</span> <span class="o">=</span> <span class="n">change_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_sizes</span> <span class="o">=</span> <span class="n">change_sizes</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">measures</span> <span class="o">=</span> <span class="n">get_sizes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_measure</span> <span class="o">=</span> <span class="n">set_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_measures</span> <span class="o">=</span> <span class="n">set_sizes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_measure</span> <span class="o">=</span> <span class="n">change_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_measures</span> <span class="o">=</span> <span class="n">change_sizes</span>

    <span class="k">def</span> <span class="nf">_add_extra_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal function used to add extra member functions depending</span>
<span class="sd">        on the type of object being edited</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;set_length&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_bond_functions</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;set_size&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_angle_functions</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal function that constructs from a single view&quot;&quot;&quot;</span>
        <span class="n">molnum</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">number</span><span class="p">()</span>
        <span class="n">molcursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="n">molcursor</span><span class="o">.</span><span class="n">_d</span>

        <span class="kn">from</span> <span class="nn">..mm</span> <span class="kn">import</span> <span class="n">Bond</span><span class="p">,</span> <span class="n">Angle</span><span class="p">,</span> <span class="n">Dihedral</span><span class="p">,</span> <span class="n">Improper</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">Molecule</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">view</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Molecule</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="n">molcursor</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">view</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Bond</span><span class="p">,</span> <span class="n">Angle</span><span class="p">,</span> <span class="n">Dihedral</span><span class="p">,</span> <span class="n">Improper</span><span class="p">]:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="n">molcursor</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_internal</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="n">molcursor</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">molecule</span><span class="p">[</span><span class="n">view</span><span class="o">.</span><span class="n">index</span><span class="p">()]</span>

        <span class="n">c</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">c</span>

    <span class="k">def</span> <span class="nf">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">views</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal function to construct from a set of views&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">CursorsM</span><span class="p">()</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">views</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">_molcursors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span>

        <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">views</span><span class="p">:</span>
            <span class="n">molnum</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">number</span><span class="p">()</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">_cursors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">_molcursors</span><span class="p">[</span><span class="n">molnum</span><span class="p">]</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="n">view</span><span class="p">))</span>

        <span class="n">ret</span><span class="o">.</span><span class="n">_add_extra_functions</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># try the simplest case - the ith cursor</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">property_error</span> <span class="o">=</span> <span class="n">e</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">raise</span> <span class="n">property_error</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

                <span class="k">return</span>

        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure that all cursors are up to date&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;CursorsM::null&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">lines</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;CursorsM( size=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">lines</span><span class="si">}</span><span class="se">\n</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

<div class="viewcode-block" id="CursorsM.get"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the property associated with key &#39;key&#39;&quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">values</span></div>

<div class="viewcode-block" id="CursorsM.set"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the property associated with key &#39;key&#39; to the</span>
<span class="sd">        passed value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="CursorsM.delete"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the property associated with the key &#39;key&#39;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="CursorsM.view"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.view">[docs]</a>    <span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the view that underlies this Cursor. Note that</span>
<span class="sd">        this may not be updated to reflect the edits made.</span>
<span class="sd">        Use .commit() to get the up-to-date version of this view.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span></div>

<div class="viewcode-block" id="CursorsM.commit"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.commit">[docs]</a>    <span class="k">def</span> <span class="nf">commit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Commit all of the changes and return the newly</span>
<span class="sd">        edited multi-molecule view.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">..legacy.Mol</span> <span class="kn">import</span> <span class="n">Molecules</span>

        <span class="n">updated</span> <span class="o">=</span> <span class="n">Molecules</span><span class="p">()</span>
        <span class="n">updated</span><span class="o">.</span><span class="n">reserve</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
            <span class="n">updated</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">commit</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">updated</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span></div>

<div class="viewcode-block" id="CursorsM.atoms"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.atoms">[docs]</a>    <span class="k">def</span> <span class="nf">atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of atoms in this view,</span>
<span class="sd">        or, if &#39;id&#39; is supplied, the atoms in this view</span>
<span class="sd">        that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">atoms</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">atoms</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="CursorsM.residues"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.residues">[docs]</a>    <span class="k">def</span> <span class="nf">residues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of residues in this view,</span>
<span class="sd">        or, if &#39;id&#39; is supplied, the residues in this view</span>
<span class="sd">        that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">residues</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">residues</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="CursorsM.chains"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.chains">[docs]</a>    <span class="k">def</span> <span class="nf">chains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of chains in this view,</span>
<span class="sd">        or, if &#39;id&#39; is supplied, the chains in this view</span>
<span class="sd">        that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">chains</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">chains</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="CursorsM.segments"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.segments">[docs]</a>    <span class="k">def</span> <span class="nf">segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of segments in this view,</span>
<span class="sd">        or, if &#39;id&#39; is supplied, the segments in this view</span>
<span class="sd">        that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">segments</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">segments</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="CursorsM.molecules"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.molecules">[docs]</a>    <span class="k">def</span> <span class="nf">molecules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of the molecules in this view,</span>
<span class="sd">        or, if &#39;id&#39; is supplied, the molecules in this view</span>
<span class="sd">        that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">molecules</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">molecules</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="CursorsM.bonds"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.bonds">[docs]</a>    <span class="k">def</span> <span class="nf">bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of the bonds in this</span>
<span class="sd">        view or, if &#39;id&#39; is supplied, the bonds in this</span>
<span class="sd">        view that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">bonds</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="CursorsM.angles"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.angles">[docs]</a>    <span class="k">def</span> <span class="nf">angles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of the angles in this</span>
<span class="sd">        view or, if &#39;id&#39; is supplied, the angles in this</span>
<span class="sd">        view that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">angles</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="CursorsM.dihedrals"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.dihedrals">[docs]</a>    <span class="k">def</span> <span class="nf">dihedrals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of the dihedrals in this</span>
<span class="sd">        view or, if &#39;id&#39; is supplied, the dihedrals in this</span>
<span class="sd">        view that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">dihedrals</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="CursorsM.impropers"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.impropers">[docs]</a>    <span class="k">def</span> <span class="nf">impropers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cursors for all of the impropers in this</span>
<span class="sd">        view or, if &#39;id&#39; is supplied, the impropers in this</span>
<span class="sd">        view that match &#39;id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">impropers</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="CursorsM.atom"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.atom">[docs]</a>    <span class="k">def</span> <span class="nf">atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the atom in the molecule that matches the passed ID&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">atom</span><span class="p">(</span><span class="n">i</span><span class="p">))</span></div>

<div class="viewcode-block" id="CursorsM.residue"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.residue">[docs]</a>    <span class="k">def</span> <span class="nf">residue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the residue in the molecule that matches the passed ID.</span>
<span class="sd">        If &#39;i&#39; is None, then this returns the residue that contains</span>
<span class="sd">        this atom (if this is an atom)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">residue</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">residue</span><span class="p">(</span><span class="n">i</span><span class="p">))</span></div>

<div class="viewcode-block" id="CursorsM.chain"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.chain">[docs]</a>    <span class="k">def</span> <span class="nf">chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the chain in the molecule that matches the passed ID.</span>
<span class="sd">        If &#39;i&#39; is None, then this returns the chain that contains</span>
<span class="sd">        this atom (if this is an atom)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">chain</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">i</span><span class="p">))</span></div>

<div class="viewcode-block" id="CursorsM.segment"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.segment">[docs]</a>    <span class="k">def</span> <span class="nf">segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the segment in the molecule that matches the passed ID.</span>
<span class="sd">        If &#39;i&#39; is None, then this returns the segment that contains</span>
<span class="sd">        this atom (if this is an atom)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">segment</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">i</span><span class="p">))</span></div>

<div class="viewcode-block" id="CursorsM.molecule"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.molecule">[docs]</a>    <span class="k">def</span> <span class="nf">molecule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the molecule&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">molecules</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;There is more than one molecule in this view &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span><span class="si">}</span><span class="s2">). &quot;</span>
                    <span class="s2">&quot;You need to specify which one you want.&quot;</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="n">mols</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">molecule</span><span class="p">(</span><span class="n">i</span><span class="p">))</span></div>

<div class="viewcode-block" id="CursorsM.bond"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.bond">[docs]</a>    <span class="k">def</span> <span class="nf">bond</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the Cursor for the specified bond.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">bond</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="CursorsM.angle"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.angle">[docs]</a>    <span class="k">def</span> <span class="nf">angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the Cursor for the specified angle.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="CursorsM.dihedral"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.dihedral">[docs]</a>    <span class="k">def</span> <span class="nf">dihedral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the Cursor for the specified dihedral.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">dihedral</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="CursorsM.improper"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.improper">[docs]</a>    <span class="k">def</span> <span class="nf">improper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the Cursor for the specified improper.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">improper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="CursorsM.invert"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.invert">[docs]</a>    <span class="k">def</span> <span class="nf">invert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the inverse view of this cursor (i.e. all views that</span>
<span class="sd">        are not selected - same as view.invert())&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_views</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">invert</span><span class="p">())</span></div>

<div class="viewcode-block" id="CursorsM.apply"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the passed function (with optional position and keyword</span>
<span class="sd">        arguments) to all of the cursors in this list of Cursors.</span>
<span class="sd">        As the function is intended to use</span>
<span class="sd">        the Cursor to edit molecules, only this Cursors object will be</span>
<span class="sd">        returned.</span>

<span class="sd">        This lets you run `.apply(...).commit()` as a single line.</span>

<span class="sd">        The function can be either;</span>

<span class="sd">        1. a string containing the name of the function to call, or</span>
<span class="sd">        2. an actual function (either a normal function or a lambda expression)</span>

<span class="sd">        You can optionally pass in positional and keyword arguments</span>
<span class="sd">        here that will be passed to the function.</span>

<span class="sd">        Args:</span>
<span class="sd">            func (str or function): The function to be called, or the name</span>
<span class="sd">                                    of the function to be called.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Cursors: This list of cursors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="CursorsM.num_frames"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.num_frames">[docs]</a>    <span class="k">def</span> <span class="nf">num_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of frames in the trajectories held by</span>
<span class="sd">        this cursor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">num</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">num</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">num_frames</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">num_frames</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">num</span><span class="p">:</span>
                    <span class="n">num</span> <span class="o">=</span> <span class="n">n</span>

        <span class="k">return</span> <span class="n">num</span></div>

<div class="viewcode-block" id="CursorsM.load_frame"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.load_frame">[docs]</a>    <span class="k">def</span> <span class="nf">load_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call the &#39;load_frame&#39; function with these arguments on all</span>
<span class="sd">        contained cursors&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">load_frame</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="CursorsM.save_frame"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.save_frame">[docs]</a>    <span class="k">def</span> <span class="nf">save_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call the &#39;save_frame&#39; function with these arguments on all</span>
<span class="sd">        contained cursors&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">save_frame</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="CursorsM.delete_frame"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.delete_frame">[docs]</a>    <span class="k">def</span> <span class="nf">delete_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call the &#39;delete_frame&#39; function with these arguments on all</span>
<span class="sd">        contained cursors&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_molcursors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">delete_frame</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="CursorsM.translate"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Translate all of the atoms operated on by these cursors</span>
<span class="sd">        by the passed arguments (these are converted automatically</span>
<span class="sd">        to a sr.maths.Vector). Use &#39;map&#39; to specify the property</span>
<span class="sd">        map to use to find the coordinates property</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="CursorsM.rotate"><a class="viewcode-back" href="../../../api/mol.html#sire.mol.CursorsM.rotate">[docs]</a>    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">quaternion</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rotate all of the atoms operated on by this cursor</span>
<span class="sd">        by the passed arguments. Use &#39;map&#39; to specify the</span>
<span class="sd">        property map to use to find the coordinates property.</span>

<span class="sd">        There are many ways to specify the rotation, hence</span>
<span class="sd">        the number of named arguments:</span>

<span class="sd">        angle: (float or angle)</span>
<span class="sd">             The angle to rotate by - this is interpreted as</span>
<span class="sd">             degrees if you pass in a float. Otherwise use</span>
<span class="sd">             sire.units.degrees or sire.units.radians to specify</span>
<span class="sd">             the angle unit. This is superseded by the</span>
<span class="sd">             quaternion or matrix arguments.</span>

<span class="sd">         axis: sire.maths.Vector (or anything that can convert to a Vector)</span>
<span class="sd">             The vector about which to rotate. If this is not</span>
<span class="sd">             specified, and no other rotation specification is</span>
<span class="sd">             used, then the rotation is about the z axis.</span>
<span class="sd">             This is superseded by the quaternion or</span>
<span class="sd">             matrix arguments.</span>

<span class="sd">         center: sire.maths.Vector (or anything that can convert to a Vector)</span>
<span class="sd">             The center for the rotation. If this isn&#39;t passed then</span>
<span class="sd">             the center of mass of the atoms operated on by this</span>
<span class="sd">             cursor is used.</span>

<span class="sd">         quaternion: sire.maths.Quaternion</span>
<span class="sd">             The Quaternion description of the rotation. Note that,</span>
<span class="sd">             if you pass this, then the angle, axis and matrix</span>
<span class="sd">             arguments will be ignored.</span>

<span class="sd">         matrix: sire.maths.Matrix</span>
<span class="sd">             The 3x3 rotation matrix that describes the rotation.</span>
<span class="sd">             Note that, if you pass this, then the angle and axis</span>
<span class="sd">             arguments will be ignored. This is superseded by</span>
<span class="sd">             the quaternion argument.</span>

<span class="sd">         map: None, dict or sire.base.PropertyMap</span>
<span class="sd">             The property map used to find the coordinates property</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">..maths</span> <span class="kn">import</span> <span class="n">create_quaternion</span>

        <span class="n">quaternion</span> <span class="o">=</span> <span class="n">create_quaternion</span><span class="p">(</span>
            <span class="n">angle</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">matrix</span><span class="o">=</span><span class="n">matrix</span><span class="p">,</span> <span class="n">quaternion</span><span class="o">=</span><span class="n">quaternion</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursors</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">quaternion</span><span class="o">=</span><span class="n">quaternion</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="nb">map</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div></div>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on Jan 09, 2023</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/js/custom.js"></script>
    </body>
</html>