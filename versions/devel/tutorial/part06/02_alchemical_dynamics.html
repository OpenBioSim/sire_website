<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Restraints" href="03_restraints.html" /><link rel="prev" title="Merged Molecules" href="01_merge.html" />

    <link rel="shortcut icon" href="../../_static/favicon.png"/><!-- Generated with Sphinx 7.2.6 and Furo 2023.09.10 -->
        <title>Alchemical Dynamics - openbiosim - sire</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom_fonts.css?v=50da5bc0" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom_style.css?v=094c566b" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom_pygments.css?v=c839eb9e" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --font-stack: Changa, sans-serif;
  --font-stack--monospace: Roboto Mono, monospace;
  --color-foreground-primary: #dddddd;
  --color-foreground-secondary: #cccccc;
  --color-foreground-muted: #d0d0d0;
  --color-foreground-border: #923eb1;
  --color-background-primary: #160f30;
  --color-background-secondary: #201146;
  --color-background-hover: #4f4fb0;
  --color-background-hover--transparent: #4f4fb000;
  --color-background-border: #403333;
  --color-background-item: #411a30;
  --color-announcement-background: #000000dd;
  --color-announcement-text: #eeebee;
  --color-admonition-title-background--note: #FFFFFF33;
  --color-admonition-title-background--warning: #FF000033;
  --color-admonition-background: #FFFFFF11;
  --color-brand-primary: #eeeeee;
  --color-brand-content: #00dfef;
  --color-highlight-on-target: #333300;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">openbiosim - sire</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/logo.svg" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div>
<div class="sidebar-search">
  <div class="version_container">
    <div class="version_label">Branch</div>
    <div id="version_box" class="version_box"></div>
  </div>
</div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/index.html">Quick Start Guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Tutorial</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorial</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../index_part01.html">Part 1 - Loading and Saving</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Part 1 - Loading and Saving</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../part01/01_importing_sire.html">Importing sire</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part01/02_loading_a_molecule.html">Loading a molecule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part01/03_simple_indexing.html">Simple indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part01/04_saving_a_molecule.html">Saving a molecule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part01/05_loading_from_multiple_files.html">Loading from multiple files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part01/06_trajectories.html">Loading and saving trajectories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part01/07_supported_file_formats.html">Supported file formats</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../index_part02.html">Part 2 - Indexing and Searching</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Part 2 - Indexing and Searching</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../part02/01_indexing_atoms.html">Indexing Atoms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part02/02_indexing_residues.html">Indexing Residues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part02/03_indexing_chains.html">Indexing Chains</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part02/04_indexing_segments.html">Indexing Segments</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part02/05_indexing_molecules.html">Indexing Molecules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part02/06_indexing_bonds.html">Indexing Bonds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part02/07_indexing_angles.html">Indexing Angles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part02/08_indexing_dihedrals.html">Indexing Dihedrals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part02/09_indexing_impropers.html">Indexing Impropers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part02/10_searching.html">Searching</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../index_part03.html">Part 3 - Molecular Properties</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Part 3 - Molecular Properties</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../part03/01_atom_properties.html">Atom Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part03/02_cursors.html">Cursors and Editing Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part03/03_residue_properties.html">Residue, Chain and Segment Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part03/04_molecule_properties.html">Molecule Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part03/05_bond_properties.html">Bond Views and Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part03/06_angle_properties.html">Angle Views and Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part03/07_dihedral_properties.html">Dihedral Views and Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part03/08_improper_properties.html">Improper Views and Properties</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../index_part04.html">Part 4 - Measurement, Trajectories and Movement</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Part 4 - Measurement, Trajectories and Movement</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../part04/01_measure.html">Measuring Distances and Angles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part04/02_trajectory.html">Measuring Trajectories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part04/03_energies.html">Measuring Energies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part04/04_energy_trajectories.html">Measuring Energies Across Trajectories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part04/05_movement.html">Moving Atoms and Molecules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part04/06_move_internals.html">Moving Bonds, Angles and Dihedrals</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../index_part05.html">Part 5 - Interconverting with other Packages</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Part 5 - Interconverting with other Packages</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../part05/01_convert.html">Converting Molecules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part05/02_view.html">Viewing Molecules in 2D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part05/03_smiles.html">Creating Molecules from Smiles Strings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part05/04_smarts.html">Searching for Fragments using Smarts Strings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part05/05_dynamics.html">Molecular Dynamics and Minimisation</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="../index_part06.html">Part 6 - Morphs and Alchemical Free Energies</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Part 6 - Morphs and Alchemical Free Energies</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01_merge.html">Merged Molecules</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Alchemical Dynamics</a></li>
<li class="toctree-l3"><a class="reference internal" href="03_restraints.html">Restraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="04_alchemical_restraints.html">Alchemical Restraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="05_free_energy_perturbation.html">Running a Free Energy Perturbation Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="06_faster_fep.html">Running Faster Free Energy Simulations</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../blogposts.html">Diaries</a></li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../cheatsheet/index.html">Detailed Guides</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Detailed Guides</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../cheatsheet/search.html">Searching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cheatsheet/trajectory.html">Trajectories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cheatsheet/view.html">Viewing Molecules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cheatsheet/openmm.html">OpenMM Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cheatsheet/units.html">Units</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api/index.html">Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/sire.html">sire module</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/sire_modules.html">Sub-modules</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of Sub-modules</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_base.html">sire.base</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of sire.base</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/base.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_cas.html">sire.cas</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of sire.cas</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/cas.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_convert.html">sire.convert</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of sire.convert</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/convert.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_io.html">sire.io</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of sire.io</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/io.html">Public API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/io_parser.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_maths.html">sire.maths</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of sire.maths</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/maths.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_mm.html">sire.mm</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of sire.mm</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mm.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_mol.html">sire.mol</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of sire.mol</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mol.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_morph.html">sire.morph</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of sire.morph</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/morph.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_restraints.html">sire.restraints</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of sire.restraints</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/restraints.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_search.html">sire.search</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of sire.search</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/search.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_stream.html">sire.stream</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of sire.stream</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/stream.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_system.html">sire.system</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of sire.system</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/system.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_units.html">sire.units</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle navigation of sire.units</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/units.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_utils.html">sire.utils</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle navigation of sire.utils</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_vol.html">sire.vol</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle navigation of sire.vol</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/vol.html">Public API</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../support.html">How to ask for help</a></li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../contributing/index.html">Contributing</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><div class="visually-hidden">Toggle navigation of Contributing</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/development.html">Developer’s guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/codestyle.html">Coding Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/packaging.html">Packaging releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/roadmap.html">Roadmap</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributors.html">Contributors</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../code_of_conduct.html">Code of Conduct</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../acknowledgements.html">Acknowledgements</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="alchemical-dynamics">
<h1>Alchemical Dynamics<a class="headerlink" href="#alchemical-dynamics" title="Link to this heading">#</a></h1>
<p>You can create an alchemical molecular dynamics simulation in exactly the
same way as you would a normal molecular dynamics simulation. There
are two options:</p>
<ul class="simple">
<li><p>Use the high-level interface based on the <a class="reference internal" href="../../api/system.html#sire.system.System.minimisation" title="sire.system.System.minimisation"><code class="xref py py-func docutils literal notranslate"><span class="pre">minimisation()</span></code></a> and <a class="reference internal" href="../../api/system.html#sire.system.System.dynamics" title="sire.system.System.dynamics"><code class="xref py py-func docutils literal notranslate"><span class="pre">dynamics()</span></code></a> functions.</p></li>
<li><p>Use the low-level interface that works directly with native OpenMM objects.</p></li>
</ul>
<section id="high-level-interface">
<h2>High level interface<a class="headerlink" href="#high-level-interface" title="Link to this heading">#</a></h2>
<p>The simplest route is to use the high-level interface. Calling
<a class="reference internal" href="../../api/system.html#sire.system.System.minimisation" title="sire.system.System.minimisation"><code class="xref py py-func docutils literal notranslate"><span class="pre">minimisation()</span></code></a> or
<a class="reference internal" href="../../api/system.html#sire.system.System.dynamics" title="sire.system.System.dynamics"><code class="xref py py-func docutils literal notranslate"><span class="pre">dynamics()</span></code></a> on any collection of molecules (or
view) that contains one or more merged molecules will automatically create
an alchemical simulation. There are extra options that you can pass to
the simulation that will control how it is run:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lambda_value</span></code> - this sets the global λ-value for the simulation.
λ is a parameter that controls the morph from the reference state
(at λ=0) to the perturbed state (at λ=1).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">swap_end_states</span></code> - if set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, this will swap the end states
of the perturbation. The morph will run from the perturbed state
(at λ=0) to the reference state (at λ=1). Note that the coordinates
of the perturbed molecule will be used in this case to start the
simulation. This can be useful to calculate the reverse of the free
energy potential of mean force (PMF), to check that the reverse
free energy equals to forwards free energy.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ignore_perturbations</span></code> - if set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, this will ignore any
perturbations, and will run the dynamics without a λ-coordinate, using
the properties from the reference state (or from the perturbed state
if <code class="docutils literal notranslate"><span class="pre">swap_end_states</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>). This is useful if you want to
run a standard dynamics simulation of the reference or perturbed states,
without the machinery of alchemical dynamics.</p></li>
</ul>
<p>For example, we could minimise our alchemical system at λ=0.5 using</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sire</span> <span class="k">as</span> <span class="nn">sr</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mols</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">sr</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">sr</span><span class="o">.</span><span class="n">tutorial_url</span><span class="p">,</span> <span class="s2">&quot;merged_molecule.s3&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">mols</span><span class="o">.</span><span class="n">molecules</span><span class="p">(</span><span class="s2">&quot;molecule property is_perturbable&quot;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">mols</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">perturbation</span><span class="p">()</span><span class="o">.</span><span class="n">link_to_reference</span><span class="p">()</span><span class="o">.</span><span class="n">commit</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mols</span> <span class="o">=</span> <span class="n">mols</span><span class="o">.</span><span class="n">minimisation</span><span class="p">(</span><span class="n">lambda_value</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
<p>We can then run some dynamics at this λ-value using</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">mols</span><span class="o">.</span><span class="n">dynamics</span><span class="p">(</span><span class="n">lambda_value</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="s2">&quot;4fs&quot;</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="s2">&quot;25oC&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;10ps&quot;</span><span class="p">,</span> <span class="n">save_frequency</span><span class="o">=</span><span class="s2">&quot;1ps&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mols</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">Dynamics(completed=10 ps, energy=-33741.4 kcal mol-1, speed=90.7 ns day-1)</span>
</pre></div>
</div>
<p>The result of dynamics is a trajectory run at this λ-value. You can view the
trajectory as you would any other, using <code class="docutils literal notranslate"><span class="pre">mols.view()</span></code>.</p>
</section>
<section id="energy-trajectories">
<h2>Energy Trajectories<a class="headerlink" href="#energy-trajectories" title="Link to this heading">#</a></h2>
<p>In addition to a coordinates trajectory, dynamics also produces an
energy trajectory. This is the history of kinetic and potential energies
sampled by the molecules during the trajectory. You can access this
energy trajectory via the <a class="reference internal" href="../../api/system.html#sire.system.System.energy_trajectory" title="sire.system.System.energy_trajectory"><code class="xref py py-func docutils literal notranslate"><span class="pre">energy_trajectory()</span></code></a>
function, e.g.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">mols</span><span class="o">.</span><span class="n">energy_trajectory</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">EnergyTrajectory( size=10</span>
<span class="go">time    lambda  0.5     kinetic potential</span>
<span class="go">1       0.5     -45509.8        4402.32 -45509.8</span>
<span class="go">2       0.5     -43644.2        6105.82 -43644.2</span>
<span class="go">3       0.5     -42466.9        6635.76 -42466.9</span>
<span class="go">4       0.5     -41678.9        7006.96 -41678.9</span>
<span class="go">5       0.5     -41306.2        7019.09 -41306.2</span>
<span class="go">6       0.5     -41201.9        7098.73 -41201.9</span>
<span class="go">7       0.5     -41046.8        7229.69 -41046.8</span>
<span class="go">8       0.5     -40949.4        7172.58 -40949.4</span>
<span class="go">9       0.5     -40928.5        7234.13 -40928.5</span>
<span class="go">10      0.5     -40855.4        7226.52 -40855.4</span>
<span class="go">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Dynamics uses a random number generator for the initial velocities
and temperature control. The exact energies you get from dynamics will
be different to what is shown here.</p>
</div>
<p>The result is a <a class="reference internal" href="../../api/maths.html#sire.maths.EnergyTrajectory" title="sire.maths.EnergyTrajectory"><code class="xref py py-class docutils literal notranslate"><span class="pre">sire.maths.EnergyTrajectory</span></code></a> object. If you want,
you can also ask for the energy trajetory to be returned as a
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/frame.html">pandas DataFrame</a>,
by using the <code class="docutils literal notranslate"><span class="pre">to_pandas</span></code> argument, e.g.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">mols</span><span class="o">.</span><span class="n">energy_trajectory</span><span class="p">(</span><span class="n">to_pandas</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="go">      lambda           0.5      kinetic     potential</span>
<span class="go">time</span>
<span class="go">1.0      0.5 -45509.784041  4402.317703 -45509.784041</span>
<span class="go">2.0      0.5 -43644.165016  6105.819473 -43644.165016</span>
<span class="go">3.0      0.5 -42466.942263  6635.760728 -42466.942263</span>
<span class="go">4.0      0.5 -41678.910475  7006.955030 -41678.910475</span>
<span class="go">5.0      0.5 -41306.210905  7019.094675 -41306.210905</span>
<span class="go">6.0      0.5 -41201.944653  7098.727370 -41201.944653</span>
<span class="go">7.0      0.5 -41046.829930  7229.685671 -41046.829930</span>
<span class="go">8.0      0.5 -40949.435093  7172.578640 -40949.435093</span>
<span class="go">9.0      0.5 -40928.462340  7234.130710 -40928.462340</span>
<span class="go">10.0     0.5 -40855.386336  7226.516672 -40855.386336</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You could also have obtained a DataFrame by calling the
<a class="reference internal" href="../../api/maths.html#sire.maths.EnergyTrajectory.to_pandas" title="sire.maths.EnergyTrajectory.to_pandas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_pandas()</span></code></a> function of
the <a class="reference internal" href="../../api/maths.html#sire.maths.EnergyTrajectory" title="sire.maths.EnergyTrajectory"><code class="xref py py-class docutils literal notranslate"><span class="pre">EnergyTrajectory</span></code></a> object.</p>
</div>
<p>You calculate free energies by evaluating the potential energy for different
values of λ during dynamics. You can control which values of λ are used
(the so-called “λ-windows”) by setting the <code class="docutils literal notranslate"><span class="pre">lambda_windows</span></code> argument, e.g.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">mols</span><span class="o">.</span><span class="n">dynamics</span><span class="p">(</span><span class="n">lambda_value</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="s2">&quot;4fs&quot;</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="s2">&quot;25oC&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;10ps&quot;</span><span class="p">,</span> <span class="n">save_frequency</span><span class="o">=</span><span class="s2">&quot;1ps&quot;</span><span class="p">,</span> <span class="n">lambda_windows</span><span class="o">=</span><span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mols</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">mols</span><span class="o">.</span><span class="n">energy_trajectory</span><span class="p">()</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">())</span>
<span class="go">      lambda           0.4           0.5           0.6      kinetic     potential</span>
<span class="go">time</span>
<span class="go">1.0      0.5           NaN -45509.784041           NaN  4402.317703 -45509.784041</span>
<span class="go">2.0      0.5           NaN -43644.165016           NaN  6105.819473 -43644.165016</span>
<span class="go">3.0      0.5           NaN -42466.942263           NaN  6635.760728 -42466.942263</span>
<span class="go">4.0      0.5           NaN -41678.910475           NaN  7006.955030 -41678.910475</span>
<span class="go">5.0      0.5           NaN -41306.210905           NaN  7019.094675 -41306.210905</span>
<span class="go">6.0      0.5           NaN -41201.944653           NaN  7098.727370 -41201.944653</span>
<span class="go">7.0      0.5           NaN -41046.829930           NaN  7229.685671 -41046.829930</span>
<span class="go">8.0      0.5           NaN -40949.435093           NaN  7172.578640 -40949.435093</span>
<span class="go">9.0      0.5           NaN -40928.462340           NaN  7234.130710 -40928.462340</span>
<span class="go">10.0     0.5           NaN -40855.386336           NaN  7226.516672 -40855.386336</span>
<span class="go">11.0     0.5 -43210.778752 -43211.624385 -43211.937516  6219.582732 -43211.624385</span>
<span class="go">12.0     0.5 -42405.359296 -42405.219032 -42404.934648  6807.796036 -42405.219032</span>
<span class="go">13.0     0.5 -41724.163073 -41724.470944 -41724.664572  6942.723457 -41724.470944</span>
<span class="go">14.0     0.5 -41282.749354 -41282.638965 -41282.324706  7174.870863 -41282.638965</span>
<span class="go">15.0     0.5 -41091.395386 -41090.926489 -41090.283597  7121.938171 -41090.926489</span>
<span class="go">16.0     0.5 -41020.530186 -41020.300294 -41019.896407  7243.171748 -41020.300294</span>
<span class="go">17.0     0.5 -41027.939363 -41027.739347 -41027.365337  7112.568694 -41027.739347</span>
<span class="go">18.0     0.5 -40947.962069 -40948.210188 -40948.254438  7086.990231 -40948.210188</span>
<span class="go">19.0     0.5 -41063.162834 -41064.038343 -41064.470977  7173.505327 -41064.038343</span>
<span class="go">20.0     0.5 -40997.466132 -40997.774003 -40997.907880  7211.324644 -40997.774003</span>
</pre></div>
</div>
<p>This has run a new trajectory, evaluating the potential energy at the
simulation λ-value (0.5) as well as at λ-windows 0.4 and 0.6. You can pass in
as many or as few λ-windows as you want.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Notice how the potential energy is evaluated at λ=0.4, λ=0.5 and λ=0.6
only from 11ps onwards. The first 10ps was the first block of dynamics
where we only evaluted the energy at the simulated λ-value. The second
block of 10ps also evaluated the energy at λ=0.4 and λ=0.6.</p>
</div>
</section>
<section id="controlling-the-trajectory-frequency">
<h2>Controlling the trajectory frequency<a class="headerlink" href="#controlling-the-trajectory-frequency" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">save_frequency</span></code> parameter controls the frequency at which both
coordinate frames and potential energies are saved to the trajectory.</p>
<p>Typically you want to evaluate the energies at a much higher frequency than
you want to save frames to the coordinate trajectory. You can choose
a different frequency by either using the <code class="docutils literal notranslate"><span class="pre">frame_frequency</span></code> option to
choose a different coordinate frame frequency, and/or using the
<code class="docutils literal notranslate"><span class="pre">energy_frequency</span></code> option to choose a different energy frequency.</p>
<p>For example, here we will run dynamics saving coordinates every picosecond,
but saving energies every 20 femtoseconds.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">mols</span><span class="o">.</span><span class="n">dynamics</span><span class="p">(</span><span class="n">lambda_value</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="s2">&quot;4fs&quot;</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="s2">&quot;25oC&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;10ps&quot;</span><span class="p">,</span> <span class="n">frame_frequency</span><span class="o">=</span><span class="s2">&quot;1ps&quot;</span><span class="p">,</span> <span class="n">energy_frequency</span><span class="o">=</span><span class="s2">&quot;20fs&quot;</span><span class="p">,</span>
<span class="gp">... </span>      <span class="n">lambda_windows</span><span class="o">=</span><span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mols</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">mols</span><span class="o">.</span><span class="n">energy_trajectory</span><span class="p">()</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">())</span>
<span class="go">       lambda           0.4           0.5           0.6      kinetic     potential</span>
<span class="go">time</span>
<span class="go">1.00      0.5           NaN -45509.784041           NaN  4402.317703 -45509.784041</span>
<span class="go">2.00      0.5           NaN -43644.165016           NaN  6105.819473 -43644.165016</span>
<span class="go">3.00      0.5           NaN -42466.942263           NaN  6635.760728 -42466.942263</span>
<span class="go">4.00      0.5           NaN -41678.910475           NaN  7006.955030 -41678.910475</span>
<span class="go">5.00      0.5           NaN -41306.210905           NaN  7019.094675 -41306.210905</span>
<span class="go">...       ...           ...           ...           ...          ...           ...</span>
<span class="go">29.92     0.5 -40892.930998 -40892.850485 -40892.506350  7306.237779 -40892.850485</span>
<span class="go">29.94     0.5 -40890.720195 -40891.326823 -40891.729581  7314.180669 -40891.326823</span>
<span class="go">29.96     0.5 -40869.209679 -40868.920036 -40868.426522  7305.782760 -40868.920036</span>
<span class="go">29.98     0.5 -40828.250071 -40828.378688 -40828.243683  7270.175960 -40828.378688</span>
<span class="go">30.00     0.5 -40764.913551 -40764.504405 -40763.921264  7140.896560 -40764.504405</span>
</pre></div>
</div>
</section>
<section id="controlling-perturbations-with-a-schedule">
<h2>Controlling perturbations with a λ-schedule<a class="headerlink" href="#controlling-perturbations-with-a-schedule" title="Link to this heading">#</a></h2>
<p>So far the perturbation from the reference to the perturbed state has been
linear. λ has acted on each of the perturbable properties of the molecule
by scaling the <code class="docutils literal notranslate"><span class="pre">initial</span></code> value from the reference state to the <code class="docutils literal notranslate"><span class="pre">final</span></code>
value in the perturbed state using the equation</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[(1 - \lambda) \times \mathrm{initial} + \lambda \times \mathrm{final}\]</div>
</div>
<p>This shows that at λ=0, the perturbable properties are set to the
<code class="docutils literal notranslate"><span class="pre">initial</span></code> value, and at λ=1, the perturbable properties are set to the
<code class="docutils literal notranslate"><span class="pre">final</span></code> value. At intermediate values of λ, the perturbable properties
are linearly interpolated between the <code class="docutils literal notranslate"><span class="pre">initial</span></code> and <code class="docutils literal notranslate"><span class="pre">final</span></code> values,
e.g. at λ=0.5, the perturbable properties are set to half-way between the
<code class="docutils literal notranslate"><span class="pre">initial</span></code> and <code class="docutils literal notranslate"><span class="pre">final</span></code> values.</p>
<p>The perturbation of the parameters is controlled in the code using
a <a class="reference internal" href="../../api/cas.html#sire.cas.LambdaSchedule" title="sire.cas.LambdaSchedule"><code class="xref py py-class docutils literal notranslate"><span class="pre">sire.cas.LambdaSchedule</span></code></a>.</p>
<p>You can get the λ-schedule used by the dynamics simulation using the
<code class="xref py py-func docutils literal notranslate"><span class="pre">lambda_schedule()</span></code> function, e.g.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">lambda_schedule</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">LambdaSchedule(</span>
<span class="go">  morph: λ * final + initial * (-λ + 1)</span>
<span class="go">)</span>
</pre></div>
</div>
<p>You can plot how this schedule would morph the perturbable properties
using the <code class="xref py py-func docutils literal notranslate"><span class="pre">plot()</span></code> function, e.g.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">get_lever_values</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img alt="View of the default λ-schedule" src="../../_images/06_02_01.jpg" />
<p>This shows how the different levers available in this schedule would morph
a hyperthetical parameter that has an <code class="docutils literal notranslate"><span class="pre">initial</span></code> value of <code class="docutils literal notranslate"><span class="pre">2.0</span></code> and a
<code class="docutils literal notranslate"><span class="pre">final</span></code> value of <code class="docutils literal notranslate"><span class="pre">3.0</span></code>.</p>
<p>In this case the levers are all identical, so would change the parameter
in the same way. You can choose your own equation for the λ-schedule.
For example, maybe we want to scale the charge by the square of λ.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">set_equation</span><span class="p">(</span><span class="s2">&quot;morph&quot;</span><span class="p">,</span> <span class="s2">&quot;charge&quot;</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">s</span><span class="o">.</span><span class="n">lam</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">s</span><span class="o">.</span><span class="n">final</span><span class="p">()</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">initial</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="o">.</span><span class="n">lam</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">LambdaSchedule(</span>
<span class="go">  morph: λ * final + initial * (-λ + 1)</span>
<span class="go">    charge: λ^2 * final + initial * (-λ^2 + 1)</span>
<span class="go">)</span>
</pre></div>
</div>
<p>This shows that in the default <code class="docutils literal notranslate"><span class="pre">morph</span></code> stage of this schedule, we will
scale the <code class="docutils literal notranslate"><span class="pre">charge</span></code> parameters by λ^2, while all other parameters (the
default) will scale using λ. We can plot the result of this using;</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get_lever_values</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img alt="View of the λ-schedule where charge is scaled by λ^2" src="../../_images/06_02_02.jpg" />
<p>The above affected the default <code class="docutils literal notranslate"><span class="pre">morph</span></code> stage of the schedule. You can
append or prepend additional stages to the schedule using the
<a class="reference internal" href="../../api/cas.html#sire.cas.LambdaSchedule.append_stage" title="sire.cas.LambdaSchedule.append_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">append_stage()</span></code></a> or
<a class="reference internal" href="../../api/cas.html#sire.cas.LambdaSchedule.prepend_stage" title="sire.cas.LambdaSchedule.prepend_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">prepend_stage()</span></code></a> functions, e.g.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">append_stage</span><span class="p">(</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">final</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
<p>would append a second stage, called <code class="docutils literal notranslate"><span class="pre">scale</span></code>, which by default would
use the <code class="docutils literal notranslate"><span class="pre">final</span></code> value of the parameter. We could then add a lever to
this stage that scales down the charge to 0,</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">set_equation</span><span class="p">(</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;charge&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="o">.</span><span class="n">lam</span><span class="p">())</span> <span class="o">*</span> <span class="n">s</span><span class="o">.</span><span class="n">final</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">LambdaSchedule(</span>
<span class="go">  morph: λ * final + initial * (-λ + 1)</span>
<span class="go">    charge: λ^2 * final + initial * (-λ^2 + 1)</span>
<span class="go">  scale: final</span>
<span class="go">    charge: final * (-λ + 1)</span>
<span class="go">)</span>
</pre></div>
</div>
<p>Again, it is worth plotting the impact of this schedule on a hyperthetical
parameter.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get_lever_values</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img alt="View of the λ-schedule where charge is scaled in a second stage to zero." src="../../_images/06_02_03.jpg" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The value of the stage-local λ in each stage moves from 0 to 1.
This is different to the global λ, which moves from 0 to 1 evenly
over all stages. For example, in this 2-stage schedule, values of
global λ between 0 and 0.5 will be in the <code class="docutils literal notranslate"><span class="pre">morph</span></code> stage, while
values of global λ between 0.5 and 1 will be in the <code class="docutils literal notranslate"><span class="pre">scale</span></code> stage.
Within the <code class="docutils literal notranslate"><span class="pre">morph</span></code> stage, the local λ will move from 0 to 1
(corresponding to global λ values of 0 to 0.5), while
within the <code class="docutils literal notranslate"><span class="pre">scale</span></code> stage, the local λ will move from 0 to 1
(corresponding to gloabl λ values of 0.5 to 1).</p>
</div>
<p>Through the combination of adding stages and specifyig different equations
for levers, you can have a lot of control over how the perturbable properties
are morphed from the reference to the perturbed states.</p>
<p>To make things easier, there are some simple functions that let you add
some common stages.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">cas</span><span class="o">.</span><span class="n">LambdaSchedule</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">LambdaSchedule::null</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">add_morph_stage</span><span class="p">(</span><span class="s2">&quot;morph&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">LambdaSchedule(</span>
<span class="go">  morph: final * λ + initial * (-λ + 1)</span>
<span class="go">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">add_charge_scale_stages</span><span class="p">(</span><span class="s2">&quot;decharge&quot;</span><span class="p">,</span> <span class="s2">&quot;recharge&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">LambdaSchedule(</span>
<span class="go">  decharge: initial</span>
<span class="go">    charge: initial * (-λ * (-γ + 1) + 1)</span>
<span class="go">  morph: final * λ + initial * (-λ + 1)</span>
<span class="go">    charge: γ * (final * λ + initial * (-λ + 1))</span>
<span class="go">  recharge: final</span>
<span class="go">    charge: final * (-(-γ + 1) * (-λ + 1) + 1)</span>
<span class="go">  γ == 0.2</span>
<span class="go">)</span>
</pre></div>
</div>
<p>has created a null schedule, and then added a <code class="docutils literal notranslate"><span class="pre">morph</span></code> stage using the
default perturbation equation. This is then sandwiched by two stages;
a <code class="docutils literal notranslate"><span class="pre">decharge</span></code> stage that scales the charge lever from the <code class="docutils literal notranslate"><span class="pre">initial</span></code>
value to γ times that value, and a <code class="docutils literal notranslate"><span class="pre">recharge</span></code> stage that scales
the charge lever from γ times the <code class="docutils literal notranslate"><span class="pre">final</span></code> value to the full
<code class="docutils literal notranslate"><span class="pre">final</span></code> value. It also scales the charge lever in the <code class="docutils literal notranslate"><span class="pre">morph</span></code> stage
by γ, which is set to 0.2 for all stages.</p>
<p>We can see how this would affect a hyperthetical parameter that goes
from an <code class="docutils literal notranslate"><span class="pre">initial</span></code> value of 2.0 to a <code class="docutils literal notranslate"><span class="pre">final</span></code> value of 3.0 via</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get_lever_values</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img alt="View of the λ-schedule that sandwiches a standard morph stage between two stages that scale the charge lever." src="../../_images/06_02_04.jpg" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Schedules constructed outside of the dynamics simulation do not have
the full set of levers (e.g. torsion_k, dih_scale etc) as
levers are only added as they are needed (hence why only
<code class="docutils literal notranslate"><span class="pre">default</span></code> and <code class="docutils literal notranslate"><span class="pre">charge</span></code> are shown here). The additional levers
are added when the schedule is added to the simulation.</p>
</div>
<p>Once you have created your schedule you can add it via the
<a class="reference internal" href="../../api/mol.html#sire.mol.Dynamics.set_schedule" title="sire.mol.Dynamics.set_schedule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_schedule()</span></code></a> function of the
<a class="reference internal" href="../../api/mol.html#sire.mol.Dynamics" title="sire.mol.Dynamics"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dynamics</span></code></a> object, e.g.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">set_schedule</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, you can set the schedule when you call the
<a class="reference internal" href="../../api/mol.html#sire.mol.SelectorMol.dynamics" title="sire.mol.SelectorMol.dynamics"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dynamics()</span></code></a> function, e.g.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">mols</span><span class="o">.</span><span class="n">dynamics</span><span class="p">(</span><span class="n">lambda_value</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="s2">&quot;4fs&quot;</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="s2">&quot;25oC&quot;</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">schedule</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get_schedule</span><span class="p">())</span>
<span class="go">LambdaSchedule(</span>
<span class="go">  decharge: initial</span>
<span class="go">    charge: (-(-γ + 1) * λ + 1) * initial</span>
<span class="go">  morph: final * λ + (-λ + 1) * initial</span>
<span class="go">    charge: γ * (final * λ + (-λ + 1) * initial)</span>
<span class="go">  recharge: final</span>
<span class="go">    charge: (-(-γ + 1) * (-λ + 1) + 1) * final</span>
<span class="go">  γ == 0.2</span>
<span class="go">)</span>
</pre></div>
</div>
</section>
<section id="ghost-atoms-and-softening-potentials">
<h2>Ghost Atoms and Softening potentials<a class="headerlink" href="#ghost-atoms-and-softening-potentials" title="Link to this heading">#</a></h2>
<p>Internally the alchemical dynamics simulation works by calculating morphed
forcefield parameters whenever λ is changed, and then calling the
OpenMM <a class="reference external" href="http://docs.openmm.org/latest/api-c++/generated/NonbondedForce.html#classOpenMM_1_1NonbondedForce_1abc68b57ace47dafd3bf2e601b3cfa6eb">updateParametersInContext function</a>
function to update those parameters in all of the OpenMM Force objects that
are used to calculate atomic forces. This is a very efficient way of
performing a perturbation, as it allows vanilla (standard) OpenMM forces
to be used for the dynamics. However, there are challenges with how
we handle atoms which are created or deleted during the perturbation.</p>
<p>These atoms, which we call “ghost atoms”, provide either a space into which
a new atom is grown, or a space from which an atom is deleted. To ensure
these ghost atoms don’t cause dynamics instabilities, we use a softening
potential to model their interactions with all other atoms. These
softening potentials (also called “soft-core” potentials) soften the
charge and Lennard-Jones interactions between the ghost atoms and all
other atoms using an α (alpha) parameter. This is a perturbable parameter
of the atoms, which is equal to 1 when the atom is in a ghost state,
and 0 when it is not. For example, an atom which exists in the reference
state but becomes a ghost in the perturbed state would have an α value
that would go from 0 to 1. Alternatively, an atom which does not exist
in the reference state, and that appears in the perturbed state, would
have an α value that would go from 1 to 0.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can have as many or few ghost atoms as you want in your merged
molecule. If all atoms become ghosts, then this is the same as
completely decoupling the molecule, as you would do in an
absolute binding free energy calculation. Equally, you could
run a “dual topology” calculation by two sets of atoms in your
merged molecule - the first set start as the reference state atoms,
and all become ghosts, while the second set start all as ghosts
and become the perturbed state atoms. In “single topology” calculations
you would only use ghost atoms for those which don’t exist in either
of the end states.</p>
</div>
<p>There are two parameters that control the softening potential:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">shift_delta</span></code> - set the <code class="docutils literal notranslate"><span class="pre">shift_delta</span></code> parameter which is used to
control the electrostatic and van der Waals softening potential that
smooths the creation or deletion of ghost atoms. This is a floating
point number that defaults to <code class="docutils literal notranslate"><span class="pre">1.0</span></code>, which should be good for
most perturbations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">coulomb_power</span></code> - set the <code class="docutils literal notranslate"><span class="pre">coulomb_power</span></code> parameter which is used
to control the electrostatic softening potential that smooths the
creation and deletion of ghost atoms. This is an integer that defaults
to <code class="docutils literal notranslate"><span class="pre">0</span></code>, which should be good for most perturbations.</p></li>
</ul>
</section>
<section id="low-level-interface">
<h2>Low level interface<a class="headerlink" href="#low-level-interface" title="Link to this heading">#</a></h2>
<p>The high-level interface is just a set of convienient wrappers around the
OpenMM objects which are used to run the simulation. If you convert
any set of views (or view) that contains merged molecules, then an
alchemical OpenMM context will be returned.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">convert</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="s2">&quot;openmm&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<span class="go">openmm::Context( num_atoms=12167 integrator=VerletIntegrator timestep=1.0 fs platform=HIP )</span>
</pre></div>
</div>
<p>The context is held in a low-level class,
<code class="xref py py-class docutils literal notranslate"><span class="pre">SOMMContext</span></code>, which inherits from the
standard <a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.openmm.Context.html#openmm.openmm.Context">OpenMM Context</a>
class.</p>
<p>The class adds some additional metadata and control functions that are needed
to update the atomic parameters in the OpenMM Context to represent the
molecular system at different values of λ.</p>
<p>The key additional functions provided by <code class="xref py py-class docutils literal notranslate"><span class="pre">SOMMContext</span></code>
are;</p>
<ul class="simple">
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">get_lambda()</span></code> - return the
current value of λ for the context.</p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">set_lambda()</span></code> - set the
new value of λ for the context. Note that this should only really
be used to change λ to evaluate energies at different λ-windows.
It is better to re-create the context if you want to simulate
at a different λ-value.</p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">get_lambda_schedule()</span></code> - return the
λ-schedule used to control the morph.</p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">set_lambda_schedule()</span></code> - set the
λ-schedule used to control the morph.</p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">get_energy()</span></code> - return the
current potential energy of the context. This will be in <a class="reference internal" href="../../api/sire.html#module-sire" title="sire"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sire</span></code></a>
units if <code class="docutils literal notranslate"><span class="pre">to_sire_units</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> (the default).</p></li>
</ul>
<p>Note that you can also set the <code class="docutils literal notranslate"><span class="pre">lambda_value</span></code> and <code class="docutils literal notranslate"><span class="pre">lambda_schedule</span></code>
when you create the context using the <code class="docutils literal notranslate"><span class="pre">map</span></code>, e.g.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">convert</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="s2">&quot;openmm&quot;</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="nb">map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;lambda_value&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;schedule&quot;</span><span class="p">:</span> <span class="n">s</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<span class="go">openmm::Context( num_atoms=12167 integrator=VerletIntegrator timestep=1.0 fs platform=HIP )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">get_lambda</span><span class="p">())</span>
<span class="go">0.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">get_lambda_schedule</span><span class="p">())</span>
<span class="go">LambdaSchedule(</span>
<span class="go">  decharge: initial</span>
<span class="go">    charge: (-(-γ + 1) * λ + 1) * initial</span>
<span class="go">  morph: final * λ + (-λ + 1) * initial</span>
<span class="go">    charge: γ * (final * λ + (-λ + 1) * initial)</span>
<span class="go">  recharge: final</span>
<span class="go">    charge: (-(-γ + 1) * (-λ + 1) + 1) * final</span>
<span class="go">  γ == 0.2</span>
<span class="go">)</span>
</pre></div>
</div>
<p>You can then run dynamics as you would do normally using the standard
OpenMM python API, e.g.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">integrator</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">getIntegrator</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">integrator</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>You can then call <code class="docutils literal notranslate"><span class="pre">get_potential_energy()</span></code> and <code class="docutils literal notranslate"><span class="pre">set_lambda()</span></code> to
get the energy during dynamics for different values of λ, e.g.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_lambda</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">get_lambda</span><span class="p">(),</span> <span class="n">context</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">())</span>
<span class="go">0.0 -38727.2 kcal mol-1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_lambda</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">get_lambda</span><span class="p">(),</span> <span class="n">context</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">())</span>
<span class="go">0.5 -38743.8 kcal mol-1</span>
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="03_restraints.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Restraints</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="01_merge.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Merged Molecules</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on Oct 10, 2023</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Alchemical Dynamics</a><ul>
<li><a class="reference internal" href="#high-level-interface">High level interface</a></li>
<li><a class="reference internal" href="#energy-trajectories">Energy Trajectories</a></li>
<li><a class="reference internal" href="#controlling-the-trajectory-frequency">Controlling the trajectory frequency</a></li>
<li><a class="reference internal" href="#controlling-perturbations-with-a-schedule">Controlling perturbations with a λ-schedule</a></li>
<li><a class="reference internal" href="#ghost-atoms-and-softening-potentials">Ghost Atoms and Softening potentials</a></li>
<li><a class="reference internal" href="#low-level-interface">Low level interface</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=4dfd88e5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=32e29ea5"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../../_static/js/custom.js?v=c9df2d0f"></script>
    </body>
</html>