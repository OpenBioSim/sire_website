<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Ghost Atoms and Softening Potentials" href="03_ghosts.html" /><link rel="prev" title="Perturbation" href="01_perturbation.html" />

    <link rel="shortcut icon" href="../../_static/favicon.png"/><!-- Generated with Sphinx 7.2.6 and Furo 2024.01.29 -->
        <title>Lambda schedules and levers - openbiosim - sire</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom_fonts.css?v=50da5bc0" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom_style.css?v=094c566b" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom_pygments.css?v=c839eb9e" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --font-stack: Changa, sans-serif;
  --font-stack--monospace: Roboto Mono, monospace;
  --color-foreground-primary: #dddddd;
  --color-foreground-secondary: #cccccc;
  --color-foreground-muted: #d0d0d0;
  --color-foreground-border: #923eb1;
  --color-background-primary: #160f30;
  --color-background-secondary: #201146;
  --color-background-hover: #4f4fb0;
  --color-background-hover--transparent: #4f4fb000;
  --color-background-border: #403333;
  --color-background-item: #411a30;
  --color-announcement-background: #000000dd;
  --color-announcement-text: #eeebee;
  --color-admonition-title-background--note: #FFFFFF33;
  --color-admonition-title-background--warning: #FF000033;
  --color-admonition-background: #FFFFFF11;
  --color-brand-primary: #eeeeee;
  --color-brand-content: #00dfef;
  --color-highlight-on-target: #333300;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">openbiosim - sire</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/logo.svg" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div>
<div class="sidebar-search">
  <div class="version_container">
    <div class="version_label">Branch</div>
    <div id="version_box" class="version_box"></div>
  </div>
</div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/index.html">Quick Start Guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Tutorial</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorial</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../index_part01.html">Part 1 - Loading and Saving</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Part 1 - Loading and Saving</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../part01/01_importing_sire.html">Importing sire</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part01/02_loading_a_molecule.html">Loading a molecule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part01/03_simple_indexing.html">Simple indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part01/04_saving_a_molecule.html">Saving a molecule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part01/05_loading_from_multiple_files.html">Loading from multiple files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part01/06_trajectories.html">Loading and saving trajectories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part01/07_supported_file_formats.html">Supported file formats</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../index_part02.html">Part 2 - Indexing and Searching</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Part 2 - Indexing and Searching</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../part02/01_indexing_atoms.html">Indexing Atoms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part02/02_indexing_residues.html">Indexing Residues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part02/03_indexing_chains.html">Indexing Chains</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part02/04_indexing_segments.html">Indexing Segments</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part02/05_indexing_molecules.html">Indexing Molecules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part02/06_indexing_bonds.html">Indexing Bonds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part02/07_indexing_angles.html">Indexing Angles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part02/08_indexing_dihedrals.html">Indexing Dihedrals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part02/09_indexing_impropers.html">Indexing Impropers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part02/10_searching.html">Searching</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../index_part03.html">Part 3 - Molecular Properties</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Part 3 - Molecular Properties</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../part03/01_atom_properties.html">Atom Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part03/02_cursors.html">Cursors and Editing Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part03/03_residue_properties.html">Residue, Chain and Segment Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part03/04_molecule_properties.html">Molecule Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part03/05_bond_properties.html">Bond Views and Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part03/06_angle_properties.html">Angle Views and Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part03/07_dihedral_properties.html">Dihedral Views and Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part03/08_improper_properties.html">Improper Views and Properties</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../index_part04.html">Part 4 - Measurement, Trajectories and Movement</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Part 4 - Measurement, Trajectories and Movement</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../part04/01_measure.html">Measuring Distances and Angles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part04/02_trajectory.html">Measuring Trajectories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part04/03_energies.html">Measuring Energies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part04/04_energy_trajectories.html">Measuring Energies Across Trajectories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part04/05_movement.html">Moving Atoms and Molecules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part04/06_move_internals.html">Moving Bonds, Angles and Dihedrals</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../index_part05.html">Part 5 - Interconverting with other Packages</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Part 5 - Interconverting with other Packages</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../part05/01_convert.html">Converting Molecules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part05/02_view.html">Viewing Molecules in 2D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part05/03_smiles.html">Creating Molecules from Smiles Strings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part05/04_smarts.html">Searching for Fragments using Smarts Strings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part05/05_dynamics.html">Molecular Dynamics and Minimisation</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../index_part06.html">Part 6 - Morphs and Alchemical Free Energies</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Part 6 - Morphs and Alchemical Free Energies</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../part06/01_merge.html">Merged Molecules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part06/02_alchemical_dynamics.html">Alchemical Dynamics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part06/03_restraints.html">Restraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part06/04_alchemical_restraints.html">Alchemical Restraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part06/05_free_energy_perturbation.html">Running a Free Energy Perturbation Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part06/06_faster_fep.html">Running Faster Free Energy Simulations</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="../index_part07.html">Part 7 - Merged Molecules and Lambda Levers</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Part 7 - Merged Molecules and Lambda Levers</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01_perturbation.html">Perturbation</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Lambda schedules and levers</a></li>
<li class="toctree-l3"><a class="reference internal" href="03_ghosts.html">Ghost Atoms and Softening Potentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="04_merge.html">Creating merge molecules</a></li>
<li class="toctree-l3"><a class="reference internal" href="05_pertfile.html">Perturbation Files (pertfiles)</a></li>
<li class="toctree-l3"><a class="reference internal" href="06_decouple.html">Annihilation and Decoupling</a></li>
<li class="toctree-l3"><a class="reference internal" href="07_residue.html">Residue mutations</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../blogposts.html">Diaries</a></li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../cheatsheet/index.html">Detailed Guides</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Detailed Guides</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../cheatsheet/search.html">Searching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cheatsheet/trajectory.html">Trajectories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cheatsheet/view.html">Viewing Molecules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cheatsheet/openmm.html">OpenMM Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cheatsheet/units.html">Units</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api/index.html">Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/sire.html">sire module</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/sire_modules.html">Sub-modules</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of Sub-modules</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_base.html">sire.base</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of sire.base</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/base.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_cas.html">sire.cas</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of sire.cas</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/cas.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_convert.html">sire.convert</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of sire.convert</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/convert.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_io.html">sire.io</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of sire.io</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/io.html">Public API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/io_parser.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_maths.html">sire.maths</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of sire.maths</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/maths.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_mm.html">sire.mm</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of sire.mm</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mm.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_mol.html">sire.mol</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of sire.mol</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mol.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_morph.html">sire.morph</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of sire.morph</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/morph.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_restraints.html">sire.restraints</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of sire.restraints</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/restraints.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_search.html">sire.search</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of sire.search</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/search.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_stream.html">sire.stream</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of sire.stream</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/stream.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_system.html">sire.system</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle navigation of sire.system</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/system.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_units.html">sire.units</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle navigation of sire.units</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/units.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_utils.html">sire.utils</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle navigation of sire.utils</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils.html">Public API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/index_vol.html">sire.vol</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><div class="visually-hidden">Toggle navigation of sire.vol</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/vol.html">Public API</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../support.html">How to ask for help</a></li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../contributing/index.html">Contributing</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><div class="visually-hidden">Toggle navigation of Contributing</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/development.html">Developer’s guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/codestyle.html">Coding Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/packaging.html">Packaging releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/roadmap.html">Roadmap</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributors.html">Contributors</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../code_of_conduct.html">Code of Conduct</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../acknowledgements.html">Acknowledgements</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="lambda-schedules-and-levers">
<h1>Lambda schedules and levers<a class="headerlink" href="#lambda-schedules-and-levers" title="Link to this heading">#</a></h1>
<p>In <a class="reference internal" href="../part06/02_alchemical_dynamics.html"><span class="doc">the last chapter</span></a> we saw how
we could use a <a class="reference internal" href="../../api/cas.html#sire.cas.LambdaSchedule" title="sire.cas.LambdaSchedule"><code class="xref py py-class docutils literal notranslate"><span class="pre">LambdaSchedule</span></code></a> to control how the
forcefield parameters of perturbable molecules are morphed as a function
of λ.</p>
<p>For example, let’s load up a merged molecule system that represents
neopentane to methane in water, and then explore the
<a class="reference internal" href="../../api/cas.html#sire.cas.LambdaSchedule" title="sire.cas.LambdaSchedule"><code class="xref py py-class docutils literal notranslate"><span class="pre">LambdaSchedule</span></code></a> that is associated with this system.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sire</span> <span class="k">as</span> <span class="nn">sr</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mols</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">load_test_files</span><span class="p">(</span><span class="s2">&quot;neo_meth_solv.bss&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mols</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">morph</span><span class="o">.</span><span class="n">link_to_reference</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span>
<span class="go">System( name=BioSimSpace_System num_molecules=879 num_residues=879 num_atoms=2651 )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">mols</span><span class="o">.</span><span class="n">dynamics</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_schedule</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">LambdaSchedule(</span>
<span class="go">  morph: (-λ + 1) * initial + λ * final</span>
<span class="go">)</span>
</pre></div>
</div>
<p>This shows that all perturbable parameters of all perturbable molecules in this
system will be morphed in a single stage (called “morph”), using a linear
interpolation between the initial and final values of the parameters.</p>
<p>As we saw in the <a class="reference internal" href="01_perturbation.html"><span class="doc">last section</span></a>, we can find the exact
values of all of the perturbable parameters of a perturbable molecule via
the perturbation object.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">mols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">perturbation</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="go">Perturbation( Molecule( Merged_Molecule:6 num_atoms=17 num_residues=1 ) )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p_omm</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">to_openmm</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">p_omm</span><span class="o">.</span><span class="n">changed_bonds</span><span class="p">())</span>
<span class="go">        bond  length0  length1         k0         k1</span>
<span class="go">0  C2:2-C4:4  0.15375  0.10969  251793.12  276646.08</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this case, we know that only the first molecule is perturbable,
hence why it is safe to use <code class="docutils literal notranslate"><span class="pre">mols[0].perturbation()</span></code>. In general,
you would need to find perturbable molecule(s), e.g. using
<code class="docutils literal notranslate"><span class="pre">pert_mols</span> <span class="pre">=</span> <span class="pre">mols.molecules(&quot;property</span> <span class="pre">is_perturbable&quot;)</span></code>.</p>
</div>
<p>From this, we can see that the bond between atoms C2 and C4 is perturbable,
and the above schedule will morph the bond length from 0.15375 nm to 0.10969 nm,
and the force constant from 251793.12 kJ mol-1 nm-2 to 276646.08 kJ mol-1 nm-2,
linearly with respect to λ.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The parameters are directly as would be used in an OpenMM force,
i.e. in OpenMM default units of nanometers and kilojoules per mole.</p>
</div>
<section id="controlling-individual-levers">
<h2>Controlling individual levers<a class="headerlink" href="#controlling-individual-levers" title="Link to this heading">#</a></h2>
<p>We can also control how individual parameters in individual forces are
morphed. We call these individual morphing controls “levers”.
So, the bond potential has two levers, its bond length, and its force constant.</p>
<p>We can list the levers that are available in the OpenMM context using the
<a class="reference internal" href="../../api/cas.html#sire.cas.LambdaSchedule.get_levers" title="sire.cas.LambdaSchedule.get_levers"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_levers()</span></code></a> function.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">get_levers</span><span class="p">())</span>
<span class="go">[&#39;charge&#39;, &#39;sigma&#39;, &#39;epsilon&#39;, &#39;charge_scale&#39;, &#39;lj_scale&#39;,</span>
<span class="go"> &#39;bond_length&#39;, &#39;bond_k&#39;, &#39;angle_size&#39;, &#39;angle_k&#39;, &#39;torsion_phase&#39;,</span>
<span class="go"> &#39;torsion_k&#39;, &#39;alpha&#39;, &#39;kappa&#39;]</span>
</pre></div>
</div>
<p>The parameter representing bond length is connected to the <code class="docutils literal notranslate"><span class="pre">bond_length</span></code> lever,
while the parameter representing the bond force constant is
connected to the <code class="docutils literal notranslate"><span class="pre">bond_k</span></code> lever.</p>
<p>We can set the morphing equation for individual levers by naming the lever
in the <a class="reference internal" href="../../api/cas.html#sire.cas.LambdaSchedule.set_equation" title="sire.cas.LambdaSchedule.set_equation"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_equation()</span></code></a> function.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">l</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">lam</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">init</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">initial</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fin</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">final</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">set_equation</span><span class="p">(</span><span class="n">stage</span><span class="o">=</span><span class="s2">&quot;morph&quot;</span><span class="p">,</span> <span class="n">lever</span><span class="o">=</span><span class="s2">&quot;bond_length&quot;</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">equation</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">init</span> <span class="o">+</span> <span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">fin</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">LambdaSchedule(</span>
<span class="go">  morph: initial * (-λ + 1) + final * λ</span>
<span class="go">    bond_length: initial * (-λ^2 + 1) + final * λ^2</span>
<span class="go">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We extracted the symbols representing λ and the initial and final
states to <code class="docutils literal notranslate"><span class="pre">l</span></code>, <code class="docutils literal notranslate"><span class="pre">init</span></code> and <code class="docutils literal notranslate"><span class="pre">fin</span></code>, just to make it easier to
write the equations.</p>
</div>
<p>We can see that the <code class="docutils literal notranslate"><span class="pre">bond_length</span></code> lever in the <code class="docutils literal notranslate"><span class="pre">morph</span></code> stage is now
interpolated from the initial to final value by λ^2, rather than λ.</p>
<p>All of the other levers continue to use the default equation for this stage,
which is the linear interpolation between the initial and final values.</p>
<p>You can change the default equation used for a stage using the
<a class="reference internal" href="../../api/cas.html#sire.cas.LambdaSchedule.set_default_equation" title="sire.cas.LambdaSchedule.set_default_equation"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_default_equation()</span></code></a> function, e.g.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">set_default_equation</span><span class="p">(</span><span class="n">stage</span><span class="o">=</span><span class="s2">&quot;morph&quot;</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="n">init</span> <span class="o">+</span> <span class="n">l</span><span class="o">*</span><span class="n">fin</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">LambdaSchedule(</span>
<span class="go">  morph: initial * (-λ + 1) + final * λ</span>
<span class="go">    bond_length: initial * (-λ^2 + 1) + final * λ^2</span>
<span class="go">)</span>
</pre></div>
</div>
</section>
<section id="controlling-individual-levers-in-individual-forces">
<h2>Controlling individual levers in individual forces<a class="headerlink" href="#controlling-individual-levers-in-individual-forces" title="Link to this heading">#</a></h2>
<p>Multiple OpenMM Force objects are combined in the OpenMM context to
model the total force acting on each atom in the system. OpenMM is very
flexible, and supports the arbitrary combination of lots of different
Force objects. In <a class="reference internal" href="../../api/sire.html#module-sire" title="sire"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sire</span></code></a>, we use a simple collection of Force objects
that, when combined, model perturbable systems. You can list the names
of the Force objects used via the <a class="reference internal" href="../../api/cas.html#sire.cas.LambdaSchedule.get_forces" title="sire.cas.LambdaSchedule.get_forces"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_forces()</span></code></a>
function.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">get_forces</span><span class="p">())</span>
<span class="go">[&#39;clj&#39;, &#39;bond&#39;, &#39;angle&#39;, &#39;torsion&#39;, &#39;ghost/ghost&#39;,</span>
<span class="go"> &#39;ghost/non-ghost&#39;, &#39;ghost-14&#39;]</span>
</pre></div>
</div>
<p>In this case, as we have a perturbable system, the Force objects used are;</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bond</span></code>: <a class="reference external" href="http://docs.openmm.org/latest/api-c++/generated/HarmonicBondForce.html">OpenMM::HarmonicBondForce</a>.
This models all of the bonds between atoms in the system. It uses
parameters that are controlled by the <code class="docutils literal notranslate"><span class="pre">bond_length</span></code> and <code class="docutils literal notranslate"><span class="pre">bond_k</span></code> levers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">angle</span></code>: <a class="reference external" href="http://docs.openmm.org/latest/api-c++/generated/HarmonicAngleForce.html">OpenMM::HarmonicAngleForce</a>.
This models all of the angles between atoms in the system. It uses
parameters that are controlled by the <code class="docutils literal notranslate"><span class="pre">angle_size</span></code> and <code class="docutils literal notranslate"><span class="pre">angle_k</span></code> levers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">torsion</span></code>: <a class="reference external" href="http://docs.openmm.org/latest/api-c++/generated/PeriodicTorsionForce.html">OpenMM::PeriodicTorsionForce</a>.
This models all of the torsions (dihedrals and impropers) in the system.
It uses parameters that are controlled by the <code class="docutils literal notranslate"><span class="pre">torsion_phase</span></code>
and <code class="docutils literal notranslate"><span class="pre">torsion_k</span></code> levers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">clj</span></code>: <a class="reference external" href="http://docs.openmm.org/latest/api-c++/generated/NonbondedForce.html">OpenMM::NonbondedForce</a>.
This models all of the electrostatic (coulomb) and van der Waals (Lennard-Jones)
interactions between non-ghost atoms in the system. Non-ghost atoms are
any atoms that are not ghosts in either end state. It uses parameters that
are controlled by the <code class="docutils literal notranslate"><span class="pre">charge</span></code>, <code class="docutils literal notranslate"><span class="pre">sigma</span></code>, <code class="docutils literal notranslate"><span class="pre">epsilon</span></code>, <code class="docutils literal notranslate"><span class="pre">charge_scale</span></code>
and <code class="docutils literal notranslate"><span class="pre">lj_scale</span></code> levers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ghost/ghost</span></code>: <a class="reference external" href="http://docs.openmm.org/latest/api-c++/generated/CustomNonbondedForce.html">OpenMM::CustomNonbondedForce</a>.
This models all of the electrostatic (coulomb) and van der Waals (Lennard-Jones)
interactions between ghost atoms in the system. Ghost atoms are any atoms
that are ghosts in either end state. It uses parameters that are controlled
by the <code class="docutils literal notranslate"><span class="pre">charge</span></code>, <code class="docutils literal notranslate"><span class="pre">sigma</span></code>, <code class="docutils literal notranslate"><span class="pre">epsilon</span></code>, <code class="docutils literal notranslate"><span class="pre">alpha</span></code> and <code class="docutils literal notranslate"><span class="pre">kappa</span></code> levers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ghost/non-ghost</span></code>: <a class="reference external" href="http://docs.openmm.org/latest/api-c++/generated/CustomNonbondedForce.html">OpenMM::CustomNonbondedForce</a>.
This models all of the electrostatic (coulomb) and van der Waals (Lennard-Jones)
interactions between the ghost atoms and the non-ghost atoms in the system.
It uses parameters that are controlled
by the <code class="docutils literal notranslate"><span class="pre">charge</span></code>, <code class="docutils literal notranslate"><span class="pre">sigma</span></code>, <code class="docutils literal notranslate"><span class="pre">epsilon</span></code>, <code class="docutils literal notranslate"><span class="pre">alpha</span></code> and <code class="docutils literal notranslate"><span class="pre">kappa</span></code> levers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ghost-14</span></code>: <a class="reference external" href="http://docs.openmm.org/latest/api-c++/generated/CustomBondForce.html">OpenMM::CustomBondForce</a>.
This models all of the 1-4 non-bonded interactions involving ghost atoms.
It uses parameters that are controlled by the <code class="docutils literal notranslate"><span class="pre">charge</span></code>, <code class="docutils literal notranslate"><span class="pre">sigma</span></code>, <code class="docutils literal notranslate"><span class="pre">epsilon</span></code>,
<code class="docutils literal notranslate"><span class="pre">alpha</span></code>, <code class="docutils literal notranslate"><span class="pre">kappa</span></code>, <code class="docutils literal notranslate"><span class="pre">charge_scale</span></code> and <code class="docutils literal notranslate"><span class="pre">lj_scale</span></code> levers.</p></li>
</ul>
<p>Some levers, like <code class="docutils literal notranslate"><span class="pre">bond_length</span></code>, are used only by a single Force object.
However, others, like <code class="docutils literal notranslate"><span class="pre">charge</span></code>, are used by multiple Force objects.</p>
<p>By default, setting a lever will affect the parameters in all of the Force
objects that use that lever. However, you can limit which Force objects
are affected by specifying the force in the <a class="reference internal" href="../../api/cas.html#sire.cas.LambdaSchedule.set_equation" title="sire.cas.LambdaSchedule.set_equation"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_equation()</span></code></a>
function.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">set_equation</span><span class="p">(</span><span class="n">stage</span><span class="o">=</span><span class="s2">&quot;morph&quot;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="s2">&quot;ghost/ghost&quot;</span><span class="p">,</span> <span class="n">lever</span><span class="o">=</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
<span class="go">                   equation=0.5*s.get_equation(&quot;morph&quot;))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">LambdaSchedule(</span>
<span class="go">  morph: initial * (-λ + 1) + final * λ</span>
<span class="go">    bond_length: (-λ^2 + 1) * initial + final * λ^2</span>
<span class="go">    ghost/ghost::alpha: 0.5 * (initial * (-λ + 1) + final * λ)</span>
<span class="go">)</span>
</pre></div>
</div>
<p>Here, we have set the <code class="docutils literal notranslate"><span class="pre">alpha</span></code> lever in the <code class="docutils literal notranslate"><span class="pre">ghost/ghost</span></code> Force object
to set the <code class="docutils literal notranslate"><span class="pre">alpha</span></code> parameter to equal half of its linearly interpolated
value.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">alpha</span></code> parameter controls the amount of softening used in the
soft-core potential for modelling ghost atoms. An <code class="docutils literal notranslate"><span class="pre">alpha</span></code> value of
0.0 means that the soft-core potential is not used, while an <code class="docutils literal notranslate"><span class="pre">alpha</span></code>
value of 1.0 means that the soft-core potential is on and strong.
Scaling up <code class="docutils literal notranslate"><span class="pre">alpha</span></code> will gradually soften any ghost atoms.</p>
</div>
</section>
<section id="controlling-individual-levers-for-individual-molecules">
<h2>Controlling individual levers for individual molecules<a class="headerlink" href="#controlling-individual-levers-for-individual-molecules" title="Link to this heading">#</a></h2>
<p>We can also control how individual levers for individual forces are
morphed for individual perturbable molecules in the system. This is useful
if you have multiple perturbable molecules, and you want to control
how each one perturbs separately.</p>
<p>To do this, we use the <a class="reference internal" href="../../api/cas.html#sire.cas.LambdaSchedule.set_molecule_schedule" title="sire.cas.LambdaSchedule.set_molecule_schedule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_molecule_schedule()</span></code></a> function
to set the schedule for a specific perturbable molecule.</p>
<p>First, let’s get the original schedule for our simulation…</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">orig_s</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_schedule</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">orig_s</span><span class="p">)</span>
<span class="go">LambdaSchedule(</span>
<span class="go">  morph: initial * (-λ + 1) + final * λ</span>
<span class="go">)</span>
</pre></div>
</div>
<p>Now, let’s set the schedule to be used <em>only</em> for the first perturbable
molecule in the system to the custom one we created earlier.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">orig_s</span><span class="o">.</span><span class="n">set_molecule_schedule</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">orig_s</span><span class="p">)</span>
<span class="go">LambdaSchedule(</span>
<span class="go">  morph: initial * (-λ + 1) + final * λ</span>
<span class="go">  Molecule schedules:</span>
<span class="go">    0: LambdaSchedule(</span>
<span class="go">  morph: initial * (-λ + 1) + final * λ</span>
<span class="go">    bond_length: (-λ^2 + 1) * initial + final * λ^2</span>
<span class="go">    ghost/ghost::alpha: 0.5 * (initial * (-λ + 1) + final * λ)</span>
<span class="go">)</span>
<span class="go">)</span>
</pre></div>
</div>
<p>This shows that the default for all perturbable molecules except the first
is to use the default morph equation for all levers in all forces.</p>
<p>However, for the first perturbable molecule (which has index <code class="docutils literal notranslate"><span class="pre">0</span></code>),
this uses our custom equation for the <code class="docutils literal notranslate"><span class="pre">bond_length</span></code> lever in the
<code class="docutils literal notranslate"><span class="pre">morph</span></code> stage, and our custom equation for the <code class="docutils literal notranslate"><span class="pre">alpha</span></code> lever in
the <code class="docutils literal notranslate"><span class="pre">ghost/ghost</span></code> force in the <code class="docutils literal notranslate"><span class="pre">morph</span></code> stage.</p>
<p>Once you are happy, we can set the schedule to be used for the simulaton
via the <a class="reference internal" href="../../api/mol.html#sire.mol.Dynamics.set_schedule" title="sire.mol.Dynamics.set_schedule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_schedule()</span></code></a> function.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">set_schedule</span><span class="p">(</span><span class="n">orig_s</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get_schedule</span><span class="p">())</span>
<span class="go">LambdaSchedule(</span>
<span class="go">  morph: initial * (-λ + 1) + final * λ</span>
<span class="go">  Molecule schedules:</span>
<span class="go">    0: LambdaSchedule(</span>
<span class="go">  morph: initial * (-λ + 1) + final * λ</span>
<span class="go">    bond_length: (-λ^2 + 1) * initial + final * λ^2</span>
<span class="go">    ghost/ghost::alpha: 0.5 * (initial * (-λ + 1) + final * λ)</span>
<span class="go">)</span>
<span class="go">)</span>
</pre></div>
</div>
</section>
<section id="viewing-the-effect-of-levers-on-a-merged-molecule">
<h2>Viewing the effect of levers on a merged molecule<a class="headerlink" href="#viewing-the-effect-of-levers-on-a-merged-molecule" title="Link to this heading">#</a></h2>
<p>You can view the effect of the <a class="reference internal" href="../../api/cas.html#sire.cas.LambdaSchedule" title="sire.cas.LambdaSchedule"><code class="xref py py-class docutils literal notranslate"><span class="pre">LambdaSchedule</span></code></a> on a
the <code class="xref py py-class docutils literal notranslate"><span class="pre">PerturbableOpenMMMolecule</span></code> using
the <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_lever_values()</span></code>
function.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">p_omm</span><span class="o">.</span><span class="n">get_lever_values</span><span class="p">(</span><span class="n">schedule</span><span class="o">=</span><span class="n">orig_s</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="go">      clj-charge-1  clj-charge-2  clj-charge-4  ...  bond-bond_length-3  angle-angle_k-19  angle-angle_size-19</span>
<span class="go">λ                                               ...</span>
<span class="go">0.00     -0.085335     -0.060235     -0.085335  ...             0.10969        387.438400             1.916372</span>
<span class="go">0.01     -0.084482     -0.059362     -0.085566  ...             0.10969        386.861008             1.915985</span>
<span class="go">0.02     -0.083629     -0.058489     -0.085797  ...             0.10969        386.283616             1.915597</span>
<span class="go">0.03     -0.082775     -0.057615     -0.086027  ...             0.10969        385.706224             1.915210</span>
<span class="go">0.04     -0.081922     -0.056742     -0.086258  ...             0.10969        385.128832             1.914822</span>
<span class="go">...            ...           ...           ...  ...                 ...               ...                  ...</span>
<span class="go">0.96     -0.003413      0.023607     -0.107477  ...             0.10969        332.008768             1.879176</span>
<span class="go">0.97     -0.002560      0.024480     -0.107708  ...             0.10969        331.431376             1.878788</span>
<span class="go">0.98     -0.001707      0.025353     -0.107939  ...             0.10969        330.853984             1.878401</span>
<span class="go">0.99     -0.000853      0.026227     -0.108169  ...             0.10969        330.276592             1.878013</span>
<span class="go">1.00      0.000000      0.027100     -0.108400  ...             0.10969        329.699200             1.877626</span>
<span class="go">[101 rows x 19 columns]</span>
</pre></div>
</div>
<p>It can be useful to plot these, to check that the morphing is as expected.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
</pre></div>
</div>
<img alt="Graph of the effect of all levers on the perturbable molecule." src="../../_images/07_02_01.jpg" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The line <code class="docutils literal notranslate"><span class="pre">ax.legend(bbox_to_anchor=(1.0,</span> <span class="pre">1.0))</span></code> is used to move the
legend outside of the plot area, so that it doesn’t obscure the data.</p>
</div>
<p>Unfortunately, the large values of the bond force constant make it very
difficult to see the effect of the <a class="reference internal" href="../../api/cas.html#sire.cas.LambdaSchedule" title="sire.cas.LambdaSchedule"><code class="xref py py-class docutils literal notranslate"><span class="pre">LambdaSchedule</span></code></a> on the
other parameters. To fix this, lets filter out any columns that contain
values that have an absolute value greater than 5.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">skip_columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">skip_columns</span><span class="p">)]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
</pre></div>
</div>
<img alt="Graph of the effect of all levers on the perturbable molecule for levers with parameters with values less than 5." src="../../_images/07_02_02.jpg" />
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="03_ghosts.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Ghost Atoms and Softening Potentials</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="01_perturbation.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Perturbation</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on Apr 09, 2024</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Lambda schedules and levers</a><ul>
<li><a class="reference internal" href="#controlling-individual-levers">Controlling individual levers</a></li>
<li><a class="reference internal" href="#controlling-individual-levers-in-individual-forces">Controlling individual levers in individual forces</a></li>
<li><a class="reference internal" href="#controlling-individual-levers-for-individual-molecules">Controlling individual levers for individual molecules</a></li>
<li><a class="reference internal" href="#viewing-the-effect-of-levers-on-a-merged-molecule">Viewing the effect of levers on a merged molecule</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=9887e882"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../../_static/js/custom.js?v=c9df2d0f"></script>
    </body>
</html>